!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";function typedArraySupport(){try{var arr=new Uint8Array(1);return arr.foo=function(){return 42},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){return this instanceof Buffer?(Buffer.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof arg?fromNumber(this,arg):"string"==typeof arg?fromString(this,arg,arguments.length>1?arguments[1]:"utf8"):fromObject(this,arg)):arguments.length>1?new Buffer(arg,arguments[1]):new Buffer(arg)}function fromNumber(that,length){if(that=allocate(that,0>length?0:0|checked(length)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;length>i;i++)that[i]=0;return that}function fromString(that,string,encoding){("string"!=typeof encoding||""===encoding)&&(encoding="utf8");var length=0|byteLength(string,encoding);return that=allocate(that,length),that.write(string,encoding),that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(null==object)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(object.buffer instanceof ArrayBuffer)return fromTypedArray(that,object);if(object instanceof ArrayBuffer)return fromArrayBuffer(that,object)}return object.length?fromArrayLike(that,object):fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=0|checked(buffer.length);return that=allocate(that,length),buffer.copy(that,0,0,length),that}function fromArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromTypedArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromArrayBuffer(that,array){return array.byteLength,Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(array),that.__proto__=Buffer.prototype):that=fromTypedArray(that,new Uint8Array(array)),that}function fromArrayLike(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromJsonObject(that,object){var array,length=0;"Buffer"===object.type&&isArray(object.data)&&(array=object.data,length=0|checked(array.length)),that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function allocate(that,length){Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length),that.__proto__=Buffer.prototype):that.length=length;var fromPool=0!==length&&length<=Buffer.poolSize>>>1;return fromPool&&(that.parent=rootParent),that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);return delete buf.parent,buf}function byteLength(string,encoding){"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if(start=0|start,end=void 0===end||end===1/0?this.length:0|end,encoding||(encoding="utf8"),0>start&&(start=0),end>this.length&&(end=this.length),start>=end)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return base64.fromByteArray(0===start&&end===buf.length?buf:buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;end>i;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(end>=i+bytesPerSequence){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:128>firstByte&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128===(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte,tempCodePoint>127&&(codePoint=tempCodePoint));break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128===(192&secondByte)&&128===(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte,tempCodePoint>2047&&(55296>tempCodePoint||tempCodePoint>57343)&&(codePoint=tempCodePoint));break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte,tempCodePoint>65535&&1114112>tempCodePoint&&(codePoint=tempCodePoint))}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(MAX_ARGUMENTS_LENGTH>=len)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;len>i;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(127&buf[i]);return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){0>value&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){0>value&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("index out of range");if(0>offset)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;length>i;i++){if(codePoint=string.charCodeAt(i),codePoint>55295&&57344>codePoint){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,128>codePoint){if((units-=1)<0)break;bytes.push(codePoint)}else if(2048>codePoint){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(65536>codePoint){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(1114112>codePoint))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("isarray");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.TYPED_ARRAY_SUPPORT?(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})):(Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];)++i;return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(0===list.length)return new Buffer(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;i++)length+=list[i].length;var buf=new Buffer(length),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?0:Buffer.compare(this,b)},Buffer.prototype.indexOf=function(val,byteOffset){function arrayIndexOf(arr,val,byteOffset){for(var foundIndex=-1,i=0;byteOffset+i<arr.length;i++)if(arr[byteOffset+i]===val[-1===foundIndex?0:i-foundIndex]){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===val.length)return byteOffset+foundIndex}else foundIndex=-1;return-1}if(byteOffset>2147483647?byteOffset=2147483647:-2147483648>byteOffset&&(byteOffset=-2147483648),byteOffset>>=0,0===this.length)return-1;if(byteOffset>=this.length)return-1;if(0>byteOffset&&(byteOffset=Math.max(this.length+byteOffset,0)),"string"==typeof val)return 0===val.length?-1:String.prototype.indexOf.call(this,val,byteOffset);if(Buffer.isBuffer(val))return arrayIndexOf(this,val,byteOffset);if("number"==typeof val)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,val,byteOffset):arrayIndexOf(this,[val],byteOffset);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else if(isFinite(offset))offset=0|offset,isFinite(length)?(length=0|length,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=0|length,length=swap}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(0>length||0>offset)||offset>this.length)throw new RangeError("attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=this.subarray(start,end),newBuf.__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;sliceLen>i;i++)newBuf[i]=this[i+start]}return newBuf.length&&(newBuf.parent=this.parent||this),newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0>value?1:0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0>value?1:0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),0>value&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&start>end&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart)throw new RangeError("targetStart out of bounds");if(0>start||start>=this.length)throw new RangeError("sourceStart out of bounds");if(0>end)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&targetStart>start&&end>targetStart)for(i=len-1;i>=0;i--)target[i+targetStart]=this[i+start];else if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;len>i;i++)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),start>end)throw new RangeError("end < start");if(end!==start&&0!==this.length){if(0>start||start>=this.length)throw new RangeError("start out of bounds");if(0>end||end>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":2,ieee754:3,isarray:4}],2:[function(require,module,exports){"use strict";function init(){var i,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",len=code.length;for(i=0;len>i;i++)lookup[i]=code[i];for(i=0;len>i;++i)revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr,len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");placeHolders="="===b64[len-2]?2:"="===b64[len-1]?1:0,arr=new Arr(3*len/4-placeHolders),l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=(16711680&tmp)>>16,arr[L++]=(65280&tmp)>>8,arr[L++]=255&tmp;return 2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;end>i;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],maxChunkLength=16383,i=0,len2=len-extraBytes;len2>i;i+=maxChunkLength)parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength));return 1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="="),parts.push(output),parts.join("")}exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array;init()},{}],3:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?0/0:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],4:[function(require,module){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],5:[function(require,module){!function(global){function CBuffer(){if(!(this instanceof CBuffer))return arguments.length>1||"number"!=typeof arguments[0]?CBuffer.apply(new CBuffer(arguments.length),arguments):new CBuffer(arguments[0]);if(0===arguments.length)throw new Error("Missing Argument: You must pass a valid buffer length");return this.size=this.start=0,this.overflow=null,arguments.length>1||"number"!=typeof arguments[0]?(this.data=new Array(arguments.length),this.end=(this.length=arguments.length)-1,this.push.apply(this,arguments)):(this.data=new Array(arguments[0]),this.end=(this.length=arguments[0])-1),this}function defaultComparitor(a,b){return a==b?0:a>b?1:-1}CBuffer.prototype={constructor:CBuffer,pop:function(){var item;if(0!==this.size)return item=this.data[this.end],delete this.data[this.end],this.end=(this.end-1+this.length)%this.length,this.size--,item},push:function(){var i=0;if(this.overflow&&this.size+arguments.length>this.length)for(;i<this.size+arguments.length-this.length;i++)this.overflow(this.data[(this.end+i+1)%this.length],this);for(i=0;i<arguments.length;i++)this.data[(this.end+i+1)%this.length]=arguments[i];return this.size<this.length&&(this.size+i>this.length?this.size=this.length:this.size+=i),this.end=(this.end+i)%this.length,this.start=(this.length+this.end-this.size+1)%this.length,this.size},reverse:function(){for(var tmp,i=0;i<~~(this.size/2);i++)tmp=this.data[(this.start+i)%this.length],this.data[(this.start+i)%this.length]=this.data[(this.start+(this.size-i-1))%this.length],this.data[(this.start+(this.size-i-1))%this.length]=tmp;return this},rotateLeft:function(cntr){if("undefined"==typeof cntr&&(cntr=1),"number"!=typeof cntr)throw new Error("Argument must be a number");for(;--cntr>=0;)this.push(this.shift());return this},rotateRight:function(cntr){if("undefined"==typeof cntr&&(cntr=1),"number"!=typeof cntr)throw new Error("Argument must be a number");for(;--cntr>=0;)this.unshift(this.pop());return this},
shift:function(){var item;if(0!==this.size)return item=this.data[this.start],this.start=(this.start+1)%this.length,this.size--,item},sort:function(fn){return this.data.sort(fn||defaultComparitor),this.start=0,this.end=this.size-1,this},unshift:function(){var i=0;if(this.overflow&&this.size+arguments.length>this.length)for(;i<this.size+arguments.length-this.length;i++)this.overflow(this.data[this.end-i%this.length],this);for(i=0;i<arguments.length;i++)this.data[(this.length+this.start-i%this.length-1)%this.length]=arguments[i];return this.length-this.size-i<0&&(this.end+=this.length-this.size-i,this.end<0&&(this.end=this.length+this.end%this.length)),this.size<this.length&&(this.size+i>this.length?this.size=this.length:this.size+=i),this.start-=arguments.length,this.start<0&&(this.start=this.length+this.start%this.length),this.size},indexOf:function(arg,idx){for(idx||(idx=0);idx<this.size;idx++)if(this.data[(this.start+idx)%this.length]===arg)return idx;return-1},lastIndexOf:function(arg,idx){for(idx||(idx=this.size-1);idx>=0;idx--)if(this.data[(this.start+idx)%this.length]===arg)return idx;return-1},sortedIndex:function(value,comparitor,context){comparitor=comparitor||defaultComparitor;var low=this.start,high=this.size-1;for(low&&comparitor.call(context,value,this.data[high])>0&&(low=0,high=this.end);high>low;){var mid=low+high>>>1;comparitor.call(context,value,this.data[mid])>0?low=mid+1:high=mid}return((low-this.start)%this.size+this.size)%this.size},every:function(callback,context){for(var i=0;i<this.size;i++)if(!callback.call(context,this.data[(this.start+i)%this.length],i,this))return!1;return!0},forEach:function(callback,context){for(var i=0;i<this.size;i++)callback.call(context,this.data[(this.start+i)%this.length],i,this)},some:function(callback,context){for(var i=0;i<this.size;i++)if(callback.call(context,this.data[(this.start+i)%this.length],i,this))return!0;return!1},avg:function(){return 0==this.size?0:this.sum()/this.size},sum:function(){for(var index=this.size,s=0;index--;)s+=this.data[index];return s},median:function(){if(0===this.size)return 0;var values=this.slice().sort(defaultComparitor),half=Math.floor(values.length/2);return values.length%2?values[half]:(values[half-1]+values[half])/2},empty:function(){return this.size=this.start=0,this.end=this.length-1,this},fill:function(arg){var i=0;if("function"==typeof arg)for(;this.data[i]=arg(),++i<this.length;);else for(;this.data[i]=arg,++i<this.length;);return this.start=0,this.end=this.length-1,this.size=this.length,this},first:function(){return this.data[this.start]},last:function(){return this.data[this.end]},get:function(arg){return this.data[(this.start+arg)%this.length]},isFull:function(){return this.length===this.size},set:function(idx,arg){return this.data[(this.start+idx)%this.length]=arg},toArray:function(){return this.slice()},slice:function(start,end){var length=this.size;if(start=+start||0,0>start){if(start>=end)return[];start=-start>length?0:length+start}null==end||end>length?end=length:0>end?end+=length:end=+end||0,length=end>start?end-start:0;for(var result=Array(length),index=0;length>index;index++)result[index]=this.data[(this.start+start+index)%this.length];return result}},"object"==typeof module&&module.exports?module.exports=CBuffer:global.CBuffer=CBuffer}(this)},{}],6:[function(require,module){"use strict";function generateMesher(order,skip,merge,append,num_options,options,useGetter){var i,j,code=[],d=order.length,append_args=new Array(2*d+1+num_options);for(i=0;d>i;++i)append_args[i]="i"+i;for(i=0;d>i;++i)append_args[i+d]="j"+i;append_args[2*d]="oval";var opt_args=new Array(num_options);for(i=0;num_options>i;++i)opt_args[i]="opt"+i,append_args[2*d+1+i]="opt"+i;code.push("var data=array.data,offset=array.offset,shape=array.shape,stride=array.stride");for(var i=0;d>i;++i)code.push(["var stride",i,"=stride[",order[i],"]|0,shape",i,"=shape[",order[i],"]|0"].join("")),code.push(i>0?["var astep",i,"=(stride",i,"-stride",i-1,"*shape",i-1,")|0"].join(""):["var astep",i,"=stride",i,"|0"].join("")),code.push(i>0?["var vstep",i,"=(vstep",i-1,"*shape",i-1,")|0"].join(""):["var vstep",i,"=1"].join("")),code.push(["var i",i,"=0,j",i,"=0,k",i,"=0,ustep",i,"=vstep",i,"|0,bstep",i,"=astep",i,"|0"].join(""));for(code.push("var a_ptr=offset>>>0,b_ptr=0,u_ptr=0,v_ptr=0,i=0,d=0,val=0,oval=0"),code.push("var count="+iota(d).map(function(i){return"shape"+i}).join("*")),code.push("var visited=mallocUint8(count)"),code.push("for(;i<count;++i){visited[i]=0}"),i=d-1;i>=0;--i)code.push(["for(i",i,"=0;i",i,"<shape",i,";++i",i,"){"].join(""));for(code.push("if(!visited[v_ptr]){"),code.push(useGetter?"val=data.get(a_ptr)":"val=data[a_ptr]"),code.push(skip?"if(!skip(val)){":"if(val!==0){"),code.push("oval = val"),i=0;d>i;++i){for(code.push("u_ptr=v_ptr+vstep"+i),code.push("b_ptr=a_ptr+stride"+i),code.push(["j",i,"_loop: for(j",i,"=1+i",i,";j",i,"<shape",i,";++j",i,"){"].join("")),j=i-1;j>=0;--j)code.push(["for(k",j,"=i",j,";k",j,"<j",j,";++k",j,"){"].join(""));for(code.push("if(visited[u_ptr]) { break j"+i+"_loop; }"),code.push(useGetter?"val=data.get(b_ptr)":"val=data[b_ptr]"),code.push(skip&&merge?"if(skip(val) || !merge(oval,val)){ break j"+i+"_loop; }":skip?"if(skip(val) || val !== oval){ break j"+i+"_loop; }":merge?"if(val === 0 || !merge(oval,val)){ break j"+i+"_loop; }":"if(val === 0 || val !== oval){ break j"+i+"_loop; }"),code.push("++u_ptr"),code.push("b_ptr+=stride0"),code.push("}"),j=1;i>=j;++j)code.push("u_ptr+=ustep"+j),code.push("b_ptr+=bstep"+j),code.push("}");d-1>i&&(code.push("d=j"+i+"-i"+i),code.push(["ustep",i+1,"=(vstep",i+1,"-vstep",i,"*d)|0"].join("")),code.push(["bstep",i+1,"=(stride",i+1,"-stride",i,"*d)|0"].join("")))}for(code.push("u_ptr=v_ptr"),i=d-1;i>=0;--i)code.push(["for(k",i,"=i",i,";k",i,"<j",i,";++k",i,"){"].join(""));for(code.push("visited[u_ptr++]=1"),code.push("}"),i=1;d>i;++i)code.push("u_ptr+=ustep"+i),code.push("}");code.push("append("+append_args.join(",")+")"),code.push("}"),code.push("}"),code.push("++v_ptr");for(var i=0;d>i;++i)code.push("a_ptr+=astep"+i),code.push("}");code.push("freeUint8(visited)"),options.debug&&(console.log("GENERATING MESHER:"),console.log(code.join("\n")));var args=["append","mallocUint8","freeUint8"];merge&&args.unshift("merge"),skip&&args.unshift("skip");var local_args=["array"].concat(opt_args),funcName=["greedyMesher",d,"d_ord",order.join("s"),skip?"skip":"",merge?"merge":""].join(""),gen_body=["'use strict';function ",funcName,"(",local_args.join(","),"){",code.join("\n"),"};return ",funcName].join("");args.push(gen_body);var proc=Function.apply(void 0,args);return skip&&merge?proc(skip,merge,append,pool.mallocUint8,pool.freeUint8):skip?proc(skip,append,pool.mallocUint8,pool.freeUint8):merge?proc(merge,append,pool.mallocUint8,pool.freeUint8):proc(append,pool.mallocUint8,pool.freeUint8)}function compileMesher(options){if(options=options||{},!options.order)throw new Error("greedy-mesher: Missing order field");if(!options.append)throw new Error("greedy-mesher: Missing append field");return generateMesher(options.order,options.skip,options.merge,options.append,0|options.extraArgs,options,!!options.useGetter)}var pool=require("typedarray-pool"),iota=(require("uniq"),require("iota-array"));module.exports=compileMesher},{"iota-array":7,"typedarray-pool":10,uniq:11}],7:[function(require,module){"use strict";function iota(n){for(var result=new Array(n),i=0;n>i;++i)result[i]=i;return result}module.exports=iota},{}],8:[function(require,module,exports){"use strict";"use restrict";function countTrailingZeros(v){var c=32;return v&=-v,v&&c--,65535&v&&(c-=16),16711935&v&&(c-=8),252645135&v&&(c-=4),858993459&v&&(c-=2),1431655765&v&&(c-=1),c}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(v){return(v>0)-(0>v)},exports.abs=function(v){var mask=v>>INT_BITS-1;return(v^mask)-mask},exports.min=function(x,y){return y^(x^y)&-(y>x)},exports.max=function(x,y){return x^(x^y)&-(y>x)},exports.isPow2=function(v){return!(v&v-1||!v)},exports.log2=function(v){var r,shift;return r=(v>65535)<<4,v>>>=r,shift=(v>255)<<3,v>>>=shift,r|=shift,shift=(v>15)<<2,v>>>=shift,r|=shift,shift=(v>3)<<1,v>>>=shift,r|=shift,r|v>>1},exports.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0},exports.popCount=function(v){return v-=v>>>1&1431655765,v=(858993459&v)+(v>>>2&858993459),16843009*(v+(v>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(v){return v+=0===v,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,v|=v>>>16,v+1},exports.prevPow2=function(v){return v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,v|=v>>>16,v-(v>>>1)},exports.parity=function(v){return v^=v>>>16,v^=v>>>8,v^=v>>>4,v&=15,27030>>>v&1};var REVERSE_TABLE=new Array(256);!function(tab){for(var i=0;256>i;++i){var v=i,r=i,s=7;for(v>>>=1;v;v>>>=1)r<<=1,r|=1&v,--s;tab[i]=r<<s&255}}(REVERSE_TABLE),exports.reverse=function(v){return REVERSE_TABLE[255&v]<<24|REVERSE_TABLE[v>>>8&255]<<16|REVERSE_TABLE[v>>>16&255]<<8|REVERSE_TABLE[v>>>24&255]},exports.interleave2=function(x,y){return x&=65535,x=16711935&(x|x<<8),x=252645135&(x|x<<4),x=858993459&(x|x<<2),x=1431655765&(x|x<<1),y&=65535,y=16711935&(y|y<<8),y=252645135&(y|y<<4),y=858993459&(y|y<<2),y=1431655765&(y|y<<1),x|y<<1},exports.deinterleave2=function(v,n){return v=v>>>n&1431655765,v=858993459&(v|v>>>1),v=252645135&(v|v>>>2),v=16711935&(v|v>>>4),v=65535&(v|v>>>16),v<<16>>16},exports.interleave3=function(x,y,z){return x&=1023,x=4278190335&(x|x<<16),x=251719695&(x|x<<8),x=3272356035&(x|x<<4),x=1227133513&(x|x<<2),y&=1023,y=4278190335&(y|y<<16),y=251719695&(y|y<<8),y=3272356035&(y|y<<4),y=1227133513&(y|y<<2),x|=y<<1,z&=1023,z=4278190335&(z|z<<16),z=251719695&(z|z<<8),z=3272356035&(z|z<<4),z=1227133513&(z|z<<2),x|z<<2},exports.deinterleave3=function(v,n){return v=v>>>n&1227133513,v=3272356035&(v|v>>>2),v=251719695&(v|v>>>4),v=4278190335&(v|v>>>8),v=1023&(v|v>>>16),v<<22>>22},exports.nextCombination=function(v){var t=v|v-1;return t+1|(~t&-~t)-1>>>countTrailingZeros(v)+1}},{}],9:[function(require,module){"use strict";function dupe_array(count,value,i){var c=0|count[i];if(0>=c)return[];var j,result=new Array(c);if(i===count.length-1)for(j=0;c>j;++j)result[j]=value;else for(j=0;c>j;++j)result[j]=dupe_array(count,value,i+1);return result}function dupe_number(count,value){var result,i;for(result=new Array(count),i=0;count>i;++i)result[i]=value;return result}function dupe(count,value){switch("undefined"==typeof value&&(value=0),typeof count){case"number":if(count>0)return dupe_number(0|count,value);break;case"object":if("number"==typeof count.length)return dupe_array(count,value,0)}return[]}module.exports=dupe},{}],10:[function(require,module,exports){(function(global,Buffer){"use strict";function freeArrayBuffer(buffer){if(buffer){var n=buffer.length||buffer.byteLength,log_n=bits.log2(n);DATA[log_n].push(buffer)}}function freeTypedArray(array){freeArrayBuffer(array.buffer)}function mallocArrayBuffer(n){var n=bits.nextPow2(n),log_n=bits.log2(n),d=DATA[log_n];return d.length>0?d.pop():new ArrayBuffer(n)}function mallocUint8(n){return new Uint8Array(mallocArrayBuffer(n),0,n)}function mallocUint16(n){return new Uint16Array(mallocArrayBuffer(2*n),0,n)}function mallocUint32(n){return new Uint32Array(mallocArrayBuffer(4*n),0,n)}function mallocInt8(n){return new Int8Array(mallocArrayBuffer(n),0,n)}function mallocInt16(n){return new Int16Array(mallocArrayBuffer(2*n),0,n)}function mallocInt32(n){return new Int32Array(mallocArrayBuffer(4*n),0,n)}function mallocFloat(n){return new Float32Array(mallocArrayBuffer(4*n),0,n)}function mallocDouble(n){return new Float64Array(mallocArrayBuffer(8*n),0,n)}function mallocUint8Clamped(n){return hasUint8C?new Uint8ClampedArray(mallocArrayBuffer(n),0,n):mallocUint8(n)}function mallocDataView(n){return new DataView(mallocArrayBuffer(n),0,n)}function mallocBuffer(n){n=bits.nextPow2(n);var log_n=bits.log2(n),cache=BUFFER[log_n];return cache.length>0?cache.pop():new Buffer(n)}var bits=require("bit-twiddle"),dup=require("dup");global.__TYPEDARRAY_POOL||(global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var hasUint8C="undefined"!=typeof Uint8ClampedArray,POOL=global.__TYPEDARRAY_POOL;POOL.UINT8C||(POOL.UINT8C=dup([32,0])),POOL.BUFFER||(POOL.BUFFER=dup([32,0]));var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function(array){if(Buffer.isBuffer(array))BUFFER[bits.log2(array.length)].push(array);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(array)&&(array=array.buffer),!array)return;var n=array.length||array.byteLength,log_n=0|bits.log2(n);DATA[log_n].push(array)}},exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray,exports.freeArrayBuffer=freeArrayBuffer,exports.freeBuffer=function(array){BUFFER[bits.log2(array.length)].push(array)},exports.malloc=function(n,dtype){if(void 0===dtype||"arraybuffer"===dtype)return mallocArrayBuffer(n);switch(dtype){case"uint8":return mallocUint8(n);case"uint16":return mallocUint16(n);case"uint32":return mallocUint32(n);case"int8":return mallocInt8(n);case"int16":return mallocInt16(n);case"int32":return mallocInt32(n);case"float":case"float32":return mallocFloat(n);case"double":case"float64":return mallocDouble(n);case"uint8_clamped":return mallocUint8Clamped(n);case"buffer":return mallocBuffer(n);case"data":case"dataview":return mallocDataView(n);default:return null}return null},exports.mallocArrayBuffer=mallocArrayBuffer,exports.mallocUint8=mallocUint8,exports.mallocUint16=mallocUint16,exports.mallocUint32=mallocUint32,exports.mallocInt8=mallocInt8,exports.mallocInt16=mallocInt16,exports.mallocInt32=mallocInt32,exports.mallocFloat32=exports.mallocFloat=mallocFloat,exports.mallocFloat64=exports.mallocDouble=mallocDouble,exports.mallocUint8Clamped=mallocUint8Clamped,exports.mallocDataView=mallocDataView,exports.mallocBuffer=mallocBuffer,exports.clearCache=function(){for(var i=0;32>i;++i)POOL.UINT8[i].length=0,POOL.UINT16[i].length=0,POOL.UINT32[i].length=0,POOL.INT8[i].length=0,POOL.INT16[i].length=0,POOL.INT32[i].length=0,POOL.FLOAT[i].length=0,POOL.DOUBLE[i].length=0,POOL.UINT8C[i].length=0,DATA[i].length=0,BUFFER[i].length=0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{"bit-twiddle":8,buffer:1,dup:9}],11:[function(require,module){"use strict";function unique_pred(list,compare){for(var ptr=1,len=list.length,a=list[0],b=list[0],i=1;len>i;++i)if(b=a,a=list[i],compare(a,b)){if(i===ptr){ptr++;continue}list[ptr++]=a}return list.length=ptr,list}function unique_eq(list){for(var ptr=1,len=list.length,a=list[0],b=list[0],i=1;len>i;++i,b=a)if(b=a,a=list[i],a!==b){if(i===ptr){ptr++;continue}list[ptr++]=a}return list.length=ptr,list}function unique(list,compare,sorted){return 0===list.length?list:compare?(sorted||list.sort(compare),unique_pred(list,compare)):(sorted||list.sort(),unique_eq(list))}module.exports=unique},{}],12:[function(require,module,exports){exports=module.exports=function(searchInput){if(searchInput&&"object"==typeof searchInput){var hasKeyCode=searchInput.which||searchInput.keyCode||searchInput.charCode;hasKeyCode&&(searchInput=hasKeyCode)}if("number"==typeof searchInput)return names[searchInput];var search=String(searchInput),foundNamedKey=codes[search.toLowerCase()];if(foundNamedKey)return foundNamedKey;var foundNamedKey=aliases[search.toLowerCase()];return foundNamedKey?foundNamedKey:1===search.length?search.charCodeAt(0):void 0};var codes=exports.code=exports.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,command:91,"right click":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},aliases=exports.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,"break":19,caps:20,"return":13,escape:27,spc:32,pgup:33,pgdn:33,ins:45,del:46,cmd:91};for(i=97;123>i;i++)codes[String.fromCharCode(i)]=i-32;for(var i=48;58>i;i++)codes[i-48]=i;for(i=1;13>i;i++)codes["f"+i]=i+111;for(i=0;10>i;i++)codes["numpad "+i]=i+96;var names=exports.names=exports.title={};for(i in codes)names[codes[i]]=i;for(var alias in aliases)codes[alias]=aliases[alias]},{}],13:[function(require,module){function hasKey(obj,keys){var o=obj;keys.slice(0,-1).forEach(function(key){o=o[key]||{}});var key=keys[keys.length-1];return key in o}function isNumber(x){return"number"==typeof x?!0:/^0x[0-9a-f]+$/i.test(x)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(x)}module.exports=function(args,opts){function argDefined(key,arg){return flags.allBools&&/^--[^=]+$/.test(arg)||flags.strings[key]||flags.bools[key]||aliases[key]}function setArg(key,val,arg){if(!arg||!flags.unknownFn||argDefined(key,arg)||flags.unknownFn(arg)!==!1){var value=!flags.strings[key]&&isNumber(val)?Number(val):val;setKey(argv,key.split("."),value),(aliases[key]||[]).forEach(function(x){setKey(argv,x.split("."),value)})}}function setKey(obj,keys,value){var o=obj;keys.slice(0,-1).forEach(function(key){void 0===o[key]&&(o[key]={}),o=o[key]});var key=keys[keys.length-1];void 0===o[key]||flags.bools[key]||"boolean"==typeof o[key]?o[key]=value:Array.isArray(o[key])?o[key].push(value):o[key]=[o[key],value]}function aliasIsBoolean(key){return aliases[key].some(function(x){return flags.bools[x]})}opts||(opts={});var flags={bools:{},strings:{},unknownFn:null};"function"==typeof opts.unknown&&(flags.unknownFn=opts.unknown),"boolean"==typeof opts["boolean"]&&opts["boolean"]?flags.allBools=!0:[].concat(opts["boolean"]).filter(Boolean).forEach(function(key){flags.bools[key]=!0});var aliases={};Object.keys(opts.alias||{}).forEach(function(key){aliases[key]=[].concat(opts.alias[key]),aliases[key].forEach(function(x){aliases[x]=[key].concat(aliases[key].filter(function(y){return x!==y}))})}),[].concat(opts.string).filter(Boolean).forEach(function(key){flags.strings[key]=!0,aliases[key]&&(flags.strings[aliases[key]]=!0)});var defaults=opts["default"]||{},argv={_:[]};Object.keys(flags.bools).forEach(function(key){setArg(key,void 0===defaults[key]?!1:defaults[key])});var notFlags=[];-1!==args.indexOf("--")&&(notFlags=args.slice(args.indexOf("--")+1),args=args.slice(0,args.indexOf("--")));for(var i=0;i<args.length;i++){var arg=args[i];if(/^--.+=/.test(arg)){var m=arg.match(/^--([^=]+)=([\s\S]*)$/),key=m[1],value=m[2];flags.bools[key]&&(value="false"!==value),setArg(key,value,arg)}else if(/^--no-.+/.test(arg)){var key=arg.match(/^--no-(.+)/)[1];setArg(key,!1,arg)}else if(/^--.+/.test(arg)){var key=arg.match(/^--(.+)/)[1],next=args[i+1];void 0===next||/^-/.test(next)||flags.bools[key]||flags.allBools||(aliases[key]?aliasIsBoolean(key):0)?/^(true|false)$/.test(next)?(setArg(key,"true"===next,arg),i++):setArg(key,flags.strings[key]?"":!0,arg):(setArg(key,next,arg),i++)}else if(/^-[^-]+/.test(arg)){for(var letters=arg.slice(1,-1).split(""),broken=!1,j=0;j<letters.length;j++){var next=arg.slice(j+2);if("-"!==next){if(/[A-Za-z]/.test(letters[j])&&/=/.test(next)){setArg(letters[j],next.split("=")[1],arg),broken=!0;break}if(/[A-Za-z]/.test(letters[j])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(next)){setArg(letters[j],next,arg),broken=!0;break}if(letters[j+1]&&letters[j+1].match(/\W/)){setArg(letters[j],arg.slice(j+2),arg),broken=!0;break}setArg(letters[j],flags.strings[letters[j]]?"":!0,arg)}else setArg(letters[j],next,arg)}var key=arg.slice(-1)[0];broken||"-"===key||(!args[i+1]||/^(-|--)[^-]/.test(args[i+1])||flags.bools[key]||(aliases[key]?aliasIsBoolean(key):0)?args[i+1]&&/true|false/.test(args[i+1])?(setArg(key,"true"===args[i+1],arg),i++):setArg(key,flags.strings[key]?"":!0,arg):(setArg(key,args[i+1],arg),i++))}else if(flags.unknownFn&&flags.unknownFn(arg)===!1||argv._.push(flags.strings._||!isNumber(arg)?arg:Number(arg)),opts.stopEarly){argv._.push.apply(argv._,args.slice(i+1));break}}return Object.keys(defaults).forEach(function(key){hasKey(argv,key.split("."))||(setKey(argv,key.split("."),defaults[key]),(aliases[key]||[]).forEach(function(x){setKey(argv,x.split("."),defaults[key])}))}),opts["--"]?(argv["--"]=new Array,notFlags.forEach(function(key){argv["--"].push(key)})):notFlags.forEach(function(key){argv._.push(key)}),argv}},{}],14:[function(require,module){function compare1st(a,b){return a[0]-b[0]}function order(){var i,stride=this.stride,terms=new Array(stride.length);for(i=0;i<terms.length;++i)terms[i]=[Math.abs(stride[i]),i];terms.sort(compare1st);var result=new Array(terms.length);for(i=0;i<result.length;++i)result[i]=terms[i][1];return result}function compileConstructor(dtype,dimension){var className=["View",dimension,"d",dtype].join("");0>dimension&&(className="View_Nil"+dtype);var useGetters="generic"===dtype;if(-1===dimension){var code="function "+className+"(a){this.data=a;};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+className+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+className+"(a){return new "+className+"(a);}",procedure=new Function(code);return procedure()}if(0===dimension){var code="function "+className+"(a,d) {this.data = a;this.offset = d};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+className+"_copy() {return new "+className+"(this.data,this.offset)};proto.pick=function "+className+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+className+"_get(){return "+(useGetters?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+className+"_set(v){return "+(useGetters?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+className+"(a,b,c,d){return new "+className+"(a,d)}",procedure=new Function("TrivialArray",code);return procedure(CACHED_CONSTRUCTORS[dtype][0])}var code=["'use strict'"],indices=iota(dimension),args=indices.map(function(i){return"i"+i}),index_str="this.offset+"+indices.map(function(i){return"this.stride["+i+"]*i"+i}).join("+"),shapeArg=indices.map(function(i){return"b"+i}).join(","),strideArg=indices.map(function(i){return"c"+i}).join(",");code.push("function "+className+"(a,"+shapeArg+","+strideArg+",d){this.data=a","this.shape=["+shapeArg+"]","this.stride=["+strideArg+"]","this.offset=d|0}","var proto="+className+".prototype","proto.dtype='"+dtype+"'","proto.dimension="+dimension),code.push("Object.defineProperty(proto,'size',{get:function "+className+"_size(){return "+indices.map(function(i){return"this.shape["+i+"]"}).join("*"),"}})"),1===dimension?code.push("proto.order=[0]"):(code.push("Object.defineProperty(proto,'order',{get:"),4>dimension?(code.push("function "+className+"_order(){"),2===dimension?code.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===dimension&&code.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):code.push("ORDER})")),code.push("proto.set=function "+className+"_set("+args.join(",")+",v){"),code.push(useGetters?"return this.data.set("+index_str+",v)}":"return this.data["+index_str+"]=v}"),code.push("proto.get=function "+className+"_get("+args.join(",")+"){"),code.push(useGetters?"return this.data.get("+index_str+")}":"return this.data["+index_str+"]}"),code.push("proto.index=function "+className+"_index(",args.join(),"){return "+index_str+"}"),code.push("proto.hi=function "+className+"_hi("+args.join(",")+"){return new "+className+"(this.data,"+indices.map(function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")}).join(",")+","+indices.map(function(i){return"this.stride["+i+"]"}).join(",")+",this.offset)}");var a_vars=indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}),c_vars=indices.map(function(i){return"c"+i+"=this.stride["+i+"]"});code.push("proto.lo=function "+className+"_lo("+args.join(",")+"){var b=this.offset,d=0,"+a_vars.join(",")+","+c_vars.join(","));for(var i=0;dimension>i;++i)code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}");code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"c"+i}).join(",")+",b)}"),code.push("proto.step=function "+className+"_step("+args.join(",")+"){var "+indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}).join(",")+","+indices.map(function(i){return"b"+i+"=this.stride["+i+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var i=0;dimension>i;++i)code.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}");code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"b"+i}).join(",")+",c)}");for(var tShape=new Array(dimension),tStride=new Array(dimension),i=0;dimension>i;++i)tShape[i]="a[i"+i+"]",tStride[i]="b[i"+i+"]";code.push("proto.transpose=function "+className+"_transpose("+args+"){"+args.map(function(n,idx){return n+"=("+n+"===undefined?"+idx+":"+n+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+className+"(this.data,"+tShape.join(",")+","+tStride.join(",")+",this.offset)}"),code.push("proto.pick=function "+className+"_pick("+args+"){var a=[],b=[],c=this.offset");for(var i=0;dimension>i;++i)code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}");code.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),code.push("return function construct_"+className+"(data,shape,stride,offset){return new "+className+"(data,"+indices.map(function(i){return"shape["+i+"]"}).join(",")+","+indices.map(function(i){return"stride["+i+"]"}).join(",")+",offset)}");var procedure=new Function("CTOR_LIST","ORDER",code.join("\n"));return procedure(CACHED_CONSTRUCTORS[dtype],order)}function arrayDType(data){if(isBuffer(data))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(data)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(data)?"array":"generic"}function wrappedNDArrayCtor(data,shape,stride,offset){if(void 0===data){var ctor=CACHED_CONSTRUCTORS.array[0];return ctor([])}"number"==typeof data&&(data=[data]),void 0===shape&&(shape=[data.length]);var d=shape.length;if(void 0===stride){stride=new Array(d);for(var i=d-1,sz=1;i>=0;--i)stride[i]=sz,sz*=shape[i]}if(void 0===offset){offset=0;for(var i=0;d>i;++i)stride[i]<0&&(offset-=(shape[i]-1)*stride[i])}for(var dtype=arrayDType(data),ctor_list=CACHED_CONSTRUCTORS[dtype];ctor_list.length<=d+1;)ctor_list.push(compileConstructor(dtype,ctor_list.length-1));var ctor=ctor_list[d+1];return ctor(data,shape,stride,offset)}var iota=require("iota-array"),isBuffer=require("is-buffer"),hasTypedArrays="undefined"!=typeof Float64Array,CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};module.exports=wrappedNDArrayCtor},{"iota-array":15,"is-buffer":16}],15:[function(require,module,exports){arguments[4][7][0].apply(exports,arguments)},{dup:7}],16:[function(require,module){module.exports=function(obj){return!(null==obj||!(obj._isBuffer||obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)))}},{}],17:[function(require,module){module.exports=function(point,vs){for(var x=point[0],y=point[1],inside=!1,i=0,j=vs.length-1;i<vs.length;j=i++){var xi=vs[i][0],yi=vs[i][1],xj=vs[j][0],yj=vs[j][1],intersect=yi>y!=yj>y&&(xj-xi)*(y-yi)/(yj-yi)+xi>x;intersect&&(inside=!inside)}return inside}},{}],18:[function(require,module){(function(global){var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null;module.exports=function(app){{var scene=app.get("scene"),object=new THREE.Object3D;app.attach(object,require("../editor/editor"))}return scene.add(object),object}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../editor/editor":35}],19:[function(require,module){(function(global){var THREE=(require("ndarray"),"undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null);module.exports=function(app){for(var scene=app.get("scene"),object=(app.get("camera"),new THREE.Object3D),blocks=app.attach(object,require("../components/blocks")),dim=[32,32,32],i=0;i<dim[0];i++)for(var j=0;j<dim[1];j++)for(var k=0;k<dim[2];k++)blocks.set(i,j,k,1);blocks.offset.set(-16,-16,-16),blocks.updateMesh();var rigidBody=app.attach(object,require("../components/rigidbody"));rigidBody.collisionObject=blocks.object,rigidBody.isFixture=!0,scene.add(object)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../components/blocks":21,"../components/rigidbody":25,ndarray:14}],20:[function(require,module){(function(global){var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null;module.exports=function(app){var scene=app.get("scene"),object=new THREE.Object3D,character=app.attach(object,require("../components/character")),rigidBody=app.attach(object,require("../components/rigidbody"));rigidBody.mass=1;var playerControl=app.attach(object,require("../components/playercontrol"));return character.rigidBody=rigidBody,playerControl.character=character,playerControl.rigidBody=rigidBody,scene.add(object),object.position.set(0,40,0),object}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../components/character":22,"../components/playercontrol":24,"../components/rigidbody":25}],21:[function(require,module){var ndarray=require("ndarray"),mesher=require("../voxel/mesher"),arrayUtils=require("../utils/arrayutils"),Blocks=function(object){this.object=object,this.type="blocks",this.dim=[16,16,16],this.chunk=ndarray([],this.dim),this.mesh=null,this.obj=new THREE.Object3D,this.material=new THREE.MultiMaterial,this.dirty=!1,this.dimNeedsUpdate=!1,this.object.add(this.obj),this.palette=[null],this.userData={}};Blocks.prototype.set=function(x,y,z,b){this.chunk.set(x,y,z,b),this.dirty=!0},Blocks.prototype.setAtCoord=function(coord,b){this.set(coord.x,coord.y,coord.z,b)},Blocks.prototype.get=function(x,y,z){return this.chunk.get(x,y,z)},Blocks.prototype.getAtCoord=function(coord){return this.get(coord.x,coord.y,coord.z)},Blocks.prototype.pointToCoord=function(point){return new THREE.Vector3(point.x-.5,point.y-.5,point.z-.5);

},Blocks.prototype.coordToPoint=function(coord){return new THREE.Vector3(coord.x,coord.y,coord.z)},Blocks.prototype.tick=function(){this.dimNeedsUpdate&&(this._updateDim(),this.dimNeedsUpdate=!1),this.updateMesh()},Blocks.prototype.clear=function(){this.chunk=ndarray([],this.dim),this.obj.remove(this.mesh)},Blocks.prototype.setDim=function(value){this.dim=value,this.dimNeedsUpdate=!0,this.dirty=!0},Blocks.prototype.visit=function(callback){for(var shape=this.chunk.shape,i=(this.chunk.data,0);i<shape[0];i++)for(var j=0;j<shape[1];j++)for(var k=0;k<shape[2];k++){var b=this.chunk.get(i,j,k);b&&callback(i,j,k,b)}},Blocks.prototype.getAllCoords=function(){var coords=[];return this.visit(function(i,j,k){coords.push(new THREE.Vector3(i,j,k))}),coords},Blocks.prototype.print=function(){this.visit(function(i,j,k,b){console.log([i,j,k].join(","),b)})},Blocks.prototype.serialize=function(){return{dim:this.dim,chunkData:arrayUtils.clone(this.chunk.data),palette:this.palette,userData:this.userData}},Blocks.prototype.deserialize=function(json){this.dim=json.dim,this.chunk=ndarray([],this.dim);for(var i=0;i<json.chunkData.length;i++)this.chunk.data[i]=json.chunkData[i];this.palette=json.palette,this.updateMaterial(),this.dimNeedsUpdate=!0,this.dirty=!0,this.userData=json.userData},Blocks.prototype.updateMesh=function(){this.dirty&&(this._updateMesh(),this.dirty=!1)},Blocks.prototype._updateMesh=function(){null!=this.mesh&&this.obj.remove(this.mesh);var self=this,dim=this.dim,result=mesher(function(i,j,k){return self.get(i,j,k)},dim),geometry=new THREE.Geometry;result.vertices.forEach(function(v){var vertice=new THREE.Vector3(v[0],v[1],v[2]);geometry.vertices.push(vertice)}),result.surfaces.forEach(function(surface){var f=surface.face,uv=surface.uv,c=f[4],face=new THREE.Face3(f[0],f[1],f[2]);geometry.faces.push(face),geometry.faceVertexUvs[0].push([uv[0],uv[1],uv[2]]),face.materialIndex=c-1,face=new THREE.Face3(f[2],f[3],f[0]),geometry.faces.push(face),geometry.faceVertexUvs[0].push([uv[2],uv[3],uv[0]]),face.materialIndex=c-1}),geometry.computeFaceNormals(),this.mesh=new THREE.Mesh(geometry,this.material),this.obj.add(this.mesh)},Blocks.prototype._updateDim=function(){for(var newChunk=ndarray([],this.dim),shape=this.chunk.shape,i=0;i<shape[0];i++)for(var j=0;j<shape[1];j++)for(var k=0;k<shape[2];k++){var b=this.chunk.get(i,j,k);b&&newChunk.set(i,j,k,b)}this.chunk=newChunk},Blocks.prototype.getOrAddColorIndex=function(color){if(!color)return 0;var index=arrayUtils.indexOf(this.palette,color);if(-1==index){this.palette.push(color),index=this.palette.length-1;var material=new THREE.MeshLambertMaterial({color:new THREE.Color(this.palette[index])});return this.material.materials.push(material),this.palette.length-1}return index},Blocks.prototype.updateMaterial=function(){this.material=new THREE.MultiMaterial;for(var i=1;i<this.palette.length;i++){var material=new THREE.MeshLambertMaterial({color:new THREE.Color(this.palette[i])});this.material.materials.push(material)}},module.exports=Blocks},{"../utils/arrayutils":59,"../voxel/mesher":62,ndarray:14}],22:[function(require,module){(function(global){var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,Character=function(object){this.object=object,this.geometry=new THREE.BoxGeometry(1,1,1),this.material=new THREE.MeshBasicMaterial({color:16711680}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.object.add(this.mesh),this.moveSpeed=.5,this.jumpSpeed=.8,this.jumping=!1};Character.prototype.tick=function(){this.gravity=this.rigidBody.gravity,this.jumping&&this.rigidBody.grounded&&(this.jumping=!1)},Character.prototype.move=function(forward,amount){var gravity=this.rigidBody.gravity;if(null!=gravity&&(this.rigidBody.grounded||this.jumping)){var verticalSpeed=this.rigidBody.velocity.clone().projectOnVector(gravity.dir),forwardSpeed=forward.clone().setLength(amount*this.moveSpeed);this.rigidBody.velocity.copy(verticalSpeed.add(forwardSpeed))}},Character.prototype.jump=function(){var gravity=this.rigidBody.gravity;null!=gravity&&this.rigidBody.grounded&&(this.jumping=!0,this.rigidBody.velocity.copy(gravity.dir.clone().multiplyScalar(-this.jumpSpeed)))},module.exports=Character}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(require,module){var PlayerCamera=function(camera,app){this.camera=camera,this.app=app,this.cameraTilt=(new THREE.Quaternion).setFromEuler(new THREE.Euler(-Math.PI/4,Math.PI/4,0,"YXZ")),this.cameraQuat=new THREE.Quaternion,this.cameraQuatFinal=new THREE.Quaternion,this.distance=100,this.target=new THREE.Vector3,this.quaternion=new THREE.Quaternion};PlayerCamera.$inject=["app"],PlayerCamera.prototype.tick=function(){var player=app.get("player");if(null!=player){var gravityDir,rigidBody=app.getComponent(player,"rigidBody");if(gravityDir=rigidBody.grounded?rigidBody.gravity.dir.clone():rigidBody.gravity.forceDir.clone(),0!=gravityDir.length()){var a=gravityDir.clone().multiplyScalar(-1),diff=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,1,0).applyQuaternion(this.cameraQuat),a);this.cameraQuat.multiplyQuaternions(diff,this.cameraQuat),this.cameraQuatFinal=(new THREE.Quaternion).multiplyQuaternions(this.cameraQuat,this.cameraTilt),this.quaternion.slerp(this.cameraQuatFinal,.1),lastGravity=gravityDir,this.updateCamera()}}},PlayerCamera.prototype.updateCamera=function(){var diff=new THREE.Vector3(0,0,1).applyQuaternion(this.quaternion).setLength(this.distance),pos=this.target.clone().add(diff);camera.position.copy(pos);var up=new THREE.Vector3(0,1,0).applyQuaternion(this.quaternion);camera.up.copy(up),camera.lookAt(this.target)},module.exports=PlayerCamera},{}],24:[function(require,module){var PlayerControl=function(object,app,input,camera){this.object=object,this.input=input,this.camera=camera,this.character=null,this.rigidBody=null};PlayerControl.$inject=["input","camera"],PlayerControl.prototype.tick=function(){var forwardAmount=0;this.input.keyHold("w")&&(forwardAmount+=1),this.input.keyHold("s")&&(forwardAmount-=1);var rightAmount=0;this.input.keyHold("d")&&(rightAmount+=1),this.input.keyHold("a")&&(rightAmount-=1);var gravity=this.rigidBody.gravity;if(null!=gravity){var normal=gravity.dir.clone().multiplyScalar(-1),up=new THREE.Vector3(0,1,0).applyQuaternion(this.camera.quaternion),right=new THREE.Vector3(1,0,0).applyQuaternion(this.camera.quaternion),move=up.multiplyScalar(forwardAmount).add(right.multiplyScalar(rightAmount));move.projectOnPlane(normal),move.setLength(1),this.character.move(move,1),this.input.keyDown("space")&&this.character.jump()}},module.exports=PlayerControl},{}],25:[function(require,module){(function(global){var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,RigidBody=function(object){this.object=object,this.velocity=new THREE.Vector3,this.acceleration=new THREE.Vector3,this.type="rigidBody",this.friction=.98,this.mass=0,this.gravity=null,this.collisionObject=null};RigidBody.prototype.applyForce=function(force){this.acceleration.add(force.clone().multiplyScalar(1/this.mass))},module.exports=RigidBody}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],26:[function(require,module){function getNextId(){return idCount++}var events=require("./events"),idCount=0,Engine=function(){this.entityMap={},this.lookup={},this.frameRate=60,this.systems=[],this.bindings={}};Engine.prototype.attach=function(object,factory){var component,args=[object],self=this;if("function"==typeof factory?(null!=factory.$inject&&factory.$inject.forEach(function(dep){args.push(self.resolve(dep))}),component=new(Function.prototype.bind.apply(factory,[null].concat(args)))):component=factory,null!=component){component.object=object,null==object._id&&(object._id=getNextId(),this.lookup[object._id]=object),null==component._id&&(component._id=getNextId(),this.lookup[component._id]=component);var components=this.entityMap[object._id];null==components&&(components=this.entityMap[object._id]={}),components[component._id]=component;for(var i=0;i<this.systems.length;i++){var system=this.systems[i];null!=system.onAttach&&system.onAttach(object,component)}}return component},Engine.prototype.use=function(type,system){var hasType="string"==typeof type;return hasType||(system=type),null!=system&&(this.systems.push(system),hasType&&this.value(type,system)),system},Engine.prototype.tick=function(){this.emit("beforeTick");for(var i=0;i<this.systems.length;i++){var system=this.systems[i];null!=system.tick&&system.tick()}for(var i in this.entityMap){var components=this.entityMap[i];for(var j in components){var component=components[j];null!=component.tick&&component.tick()}}for(var i=0;i<this.systems.length;i++){var system=this.systems[i];null!=system.lateTick&&system.lateTick()}this.emit("afterTick")},Engine.prototype.start=function(){var self=this,interval=function(){self.tick(),setTimeout(interval,1e3/this.frameRate)};interval()},Engine.prototype.value=function(type,object){this.bindings[type]={value:object}},Engine.prototype.resolve=function(type,context){var binding=this.bindings[type];if(null==binding)throw new Error("binding for type "+type+" not found");return null!=binding.factory?binding.factory(context):null!=binding.value?binding.value:void 0},Engine.prototype.get=function(type,context){return this.resolve(type,context)},Engine.prototype.getComponent=function(object,type){var components=this.entityMap[object._id];for(var id in components)if(components[id].type===type)return components[id]},Engine.prototype.loadAssembly=function(assembly){return assembly(this)},events.prototype.apply(Engine.prototype),module.exports=function(){return new Engine}},{"./events":27}],27:[function(require,module){var Events=function(){this._listeners={}};Events.prototype.emit=function(event,object){var callbacks=this._listeners[event];if(null!=callbacks)for(var i=0;i<callbacks.length;i++){var callback=callbacks[i];callback(object)}},Events.prototype.on=function(event,callback){var callbacks=this._listeners[event];null==callbacks&&(callbacks=this._listeners[event]=[]),callbacks.push(callback)},Events.prototype.off=function(event,callback){var callbacks=this._listeners[event];null!=callbacks&&arrayUtils.remove(callbacks,callback)},Events.prototype.apply=function(obj){obj.emit=this.emit,obj.on=this.on,obj.off=this.off,obj._listeners={}},module.exports=Events},{}],28:[function(require,module){module.exports={}},{}],29:[function(require,module){module.exports=["#7C7C7C","#0000FC","#0000BC","#4428BC","#940084","#A80020","#A81000","#881400","#503000","#007800","#006800","#005800","#004058","#000000","#BCBCBC","#0078F8","#0058F8","#6844FC","#D800CC","#E40058","#F83800","#E45C10","#AC7C00","#00B800","#00A800","#00A844","#008888",{src:"/images/clear.png",isClearColor:!0},"#F8F8F8","#3CBCFC","#6888FC","#9878F8","#F878F8","#F85898","#F87858","#FCA044","#F8B800","#B8F818","#58D854","#58F898","#00E8D8","#787878","#FCFCFC","#A4E4FC","#B8B8F8","#D8B8F8","#F8B8F8","#F8A4C0","#F0D0B0","#FCE0A8","#F8D878","#D8F878","#B8F8B8","#B8F8D8","#00FCFC","#F8D8F8"]},{}],30:[function(require,module){var BlockCommand=function(blocks){this.blocks=blocks,this.subCommands=[],this.deltas=[]};BlockCommand.prototype.set=function(coord,value){this.subCommands.push({coord:coord,value:value})},BlockCommand.prototype.setAtCoords=function(coords,value){this.subCommands.push({coords:coords,value:value})},BlockCommand.prototype.run=function(){for(var i=0;i<this.subCommands.length;i++)for(var subCommand=this.subCommands[i],value=subCommand.value,coords=subCommand.coords||[subCommand.coord],j=0;j<coords.length;j++){var coord=coords[j],previousValue=this.blocks.getAtCoord(coord);this.deltas.push({coord:coord,previousValue:previousValue}),this.blocks.setAtCoord(coord,value)}},BlockCommand.prototype.undo=function(){for(var i=this.deltas.length-1;i>=0;i--){var delta=this.deltas[i];this.blocks.setAtCoord(delta.coord,delta.previousValue)}},module.exports=BlockCommand},{}],31:[function(require,module){var BlockCommand=require("./blockcommand"),arrayUtils=require("../../utils/arrayutils");module.exports=function(editor,blocks,coords,offset){function normalizeCoord(coord,dim){return new THREE.Vector3((coord.x+dim[0])%dim[0],(coord.y+dim[1])%dim[1],(coord.z+dim[2])%dim[2])}for(var command=new BlockCommand(editor.blocks),toAdd=[],i=0;i<coords.length;i++){var coord=coords[i],value=blocks.getAtCoord(coord);command.set(coords[i],void 0),toAdd.push({coord:normalizeCoord((new THREE.Vector3).addVectors(coord,offset),blocks.dim),value:value})}for(var i=0;i<toAdd.length;i++){var add=toAdd[i];command.set(add.coord,add.value)}return{selectionCopy:null,run:function(){if(command.run(),this.selectionCopy=arrayUtils.clone(editor.selections),editor.selections.length>0)for(var i=0;i<editor.selections.length;i++){var normalized=normalizeCoord((new THREE.Vector3).addVectors(editor.selections[i],offset),blocks.dim);editor.selections[i]=normalized}},undo:function(){if(command.undo(),editor.selections.length>0)for(var i=0;i<editor.selections.length;i++){var normalized=normalizeCoord((new THREE.Vector3).subVectors(editor.selections[i],offset),blocks.dim);editor.selections[i]=normalized}}}}},{"../../utils/arrayutils":59,"./blockcommand":30}],32:[function(require,module){var arrayUtils=require("../../utils/arrayutils");module.exports=function(editor,selections){var originalSelections=null;return{run:function(){originalSelections=arrayUtils.clone(editor.selections),editor.selections=selections},undo:function(){editor.selections=originalSelections}}}},{"../../utils/arrayutils":59}],33:[function(require,module){var BlockCommand=require("./blockcommand");module.exports=function(blocks,coords,value){var command=new BlockCommand(blocks);return command.setAtCoords(coords,value),command}},{"./blockcommand":30}],34:[function(require,module){(function(global){var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,DragCamera=function(camera,input){this.camera=camera,this.input=input,this.rotation=new THREE.Euler(-Math.PI/4,Math.PI/4,0,"YXZ"),this.lastMouse=new THREE.Vector2,this.mouseSpeedX=.01,this.mouseSpeedY=.01,this.mouseKeySpeedX=.03,this.mouseKeySpeedY=.03,this.unitVector=new THREE.Vector3(0,0,1),this.distance=50,this.target=new THREE.Vector3(0,0,0),this.maxPitch=Math.PI/2-.01,this.minPitch=-Math.PI/2+.01,this.zoomRate=1.1,this.updateCamera(),this.lock=!1};DragCamera.$inject=["input"],DragCamera.prototype.tick=function(){this.processInput(),this.updateCamera()},DragCamera.prototype.processInput=function(){if(this.input.mouseHold()&&!this.lock){var diff=(new THREE.Vector2).subVectors(this.input.mouse,this.lastMouse);this.rotation.y+=diff.x*this.mouseSpeedY,this.rotation.x+=diff.y*this.mouseSpeedX,this.rotation.x<this.minPitch&&(this.rotation.x=this.minPitch),this.rotation.x>this.maxPitch&&(this.rotation.x=this.maxPitch)}var rotateRight=0,rotateUp=0;this.input.keyHold("right")&&rotateRight++,this.input.keyHold("left")&&rotateRight--,this.input.keyHold("up")&&rotateUp++,this.input.keyHold("down")&&rotateUp--,this.rotation.x+=rotateUp*this.mouseKeySpeedX,this.rotation.y-=rotateRight*this.mouseKeySpeedY,this.lastMouse.copy(this.input.mouse),this.input.keyUp("=")?this.distance/=this.zoomRate:this.input.keyUp("-")&&(this.distance*=this.zoomRate)},DragCamera.prototype.updateCamera=function(){var position=this.unitVector.clone().applyEuler(this.rotation).setLength(this.distance).add(this.target);this.camera.position.copy(position),this.camera.lookAt(this.target)},module.exports=DragCamera}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(require,module){(function(global){var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,CBuffer=require("cbuffer"),blocksComponent=require("../components/blocks"),dragCameraComponent=require("./dragcamera"),editorConsole=require("./editorconsole"),EditorTools=require("./editortools"),OffsetCommand=require("./commands/offsetcommand"),Blocks=require("../components/blocks"),arrayUtils=require("../utils/arrayutils"),toolBar=require("./gui/toolbar"),arrowBar=require("./gui/arrowbar"),fileBar=require("./gui/filebar"),prefabsBar=require("./gui/prefabsbar"),prefabsToolBar=require("./gui/prefabstoolbar"),colorBar=require("./gui/colorbar"),propertyPanel=require("./gui/propertypanel"),PenTool=require("./tools/pentool"),SampleTool=require("./tools/sampletool"),SelectTool=require("./tools/selecttool"),CameraTool=require("./tools/cameratool"),FillTool=require("./tools/filltool"),Editor=function(object,app,input,camera,devConsole,config,palette,canvas,prefabService){this.object=object,this.app=app,this.input=input,this.camera=camera,this.devConsole=devConsole,this.config=config,this.palette=palette,this.canvas=canvas,this.prefabService=prefabService,this.context=this.canvas.getContext("2d"),this.blocks=null,this.dragCamera=null,this.objGround=null,this.objBoundingBox=null,this._started=!1,this.materials=[],this.selectedColor=null,this.undos=CBuffer(200),this.redos=CBuffer(200),this.colorBar=null,this.prefabsBar=null,this.prefabToolbar=null,this.toolBar=null,this.arrowBar=null,this.fileBar=null,this.toolNames=[EditorTools.Pen,EditorTools.Sample,EditorTools.Select,EditorTools.Camera,EditorTools.Fill],this.toolName=EditorTools.Pen,this.tool=null,this.selections=[],this.reflectX=!1,this.reflectY=!1,this.reflectZ=!1,this.prefabs=[],this.screenshotRenderer=null,this.lastBlocks=null,this.objHighlight=null,this.sn=1e-4,this.highlightCoord=null,this.downloadElement=null,this.editLock=!1,this.cameraLock=!1,this.propertyPanel=null,this.prefabIndex=0};Editor.$inject=["app","input","camera","devConsole","config","palette","canvas","prefabService"],Editor.prototype.start=function(){editorConsole(this,this.devConsole),this.prefabs=this.prefabService.load(),this.blocks=this.app.attach(this.object,blocksComponent),this.dragCamera=this.app.attach(this.camera,dragCameraComponent),this.updateTool(),this.updateMaterial(this.blocks),this.selectedColor=this.palette[0],this.toolBar=toolBar(this),this.arrowBar=arrowBar(this),this.fileBar=fileBar(this),this.colorBar=colorBar(this),this.prefabsBar=prefabsBar(this),this.prefabsToolbar=prefabsToolBar(this),this.propertyPanel=propertyPanel(this),0===this.prefabs.length&&this.prefabs.push(this.blocks.serialize()),this.load(this.prefabs[0]),this.updateScreenshots(),this.colorBar.highlight(0),this.prefabsBar.highlight(0),this.toolBar.highlight(0)},Editor.prototype.setTool=function(name){var index=arrayUtils.indexOf(this.toolNames,name);-1!==index&&(this.toolBar.highlight(index),this.toolName=name,this.updateTool())},Editor.prototype.tick=function(){this._started||(this.start(),this._started=!0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var hasIntersect=null!=this.getCoordAbove();!hasIntersect&&this.input.mouseDown()&&(this.editLock=!0),hasIntersect&&this.input.mouseDown()&&(this.cameraLock=!0),this.input.mouseUp()&&(this.editLock=!1,this.cameraLock=!1),this.toolName===EditorTools.Select||this.toolName===EditorTools.Sample?this.cameraLock=!0:this.toolName===EditorTools.Camera&&(this.cameraLock=!1),this.dragCamera.lock=this.cameraLock,this.tool.tick(),this.updateHighlight(this.highlightCoord),this.drawSelection();var offsetCoord=null;this.input.keyDown("f")&&(offsetCoord=new THREE.Vector3(0,-1,0)),this.input.keyDown("r")&&(offsetCoord=new THREE.Vector3(0,1,0)),this.input.keyDown("a")&&(offsetCoord=new THREE.Vector3(-1,0,0)),this.input.keyDown("d")&&(offsetCoord=new THREE.Vector3(1,0,0)),this.input.keyDown("w")&&(offsetCoord=new THREE.Vector3(0,0,-1)),this.input.keyDown("s")&&(offsetCoord=new THREE.Vector3(0,0,1)),null!=offsetCoord&&this.applyOffset(offsetCoord),this.input.keyHold("command")&&this.input.keyHold("shift")?this.input.keyDown("z")&&this.redo():this.input.keyHold("command")&&this.input.keyDown("z")&&this.undo(),this.input.keyDown("1")?this.setTool(this.toolNames[0]):this.input.keyDown("2")?this.setTool(this.toolNames[1]):this.input.keyDown("3")?this.setTool(this.toolNames[2]):this.input.keyDown("4")?this.setTool(this.toolNames[3]):this.input.keyDown("5")&&this.setTool(this.toolNames[4])},Editor.prototype.undo=function(){var command=this.undos.last();null!=command&&(command.undo(),this.undos.pop(),this.redos.push(command),this.updateCurrentScreenshot())},Editor.prototype.redo=function(){var command=this.redos.last();null!=command&&(command.run(),this.redos.pop(),this.undos.push(command),this.updateCurrentScreenshot())},Editor.prototype.runCommand=function(command){command.run(),this.undos.push(command),this.redos=CBuffer(200),this.updateCurrentScreenshot()},Editor.prototype.updateCurrentScreenshot=function(){var index=this.prefabIndex;this.prefabs[index]=this.blocks.serialize(),this.updateScreenshotAtIndex(index)},Editor.prototype.updateScreenshots=function(){this.prefabsBar.clear();for(var i=0;i<this.prefabs.length;i++)this.updateScreenshotAtIndex(i)},Editor.prototype.updateScreenshotAtIndex=function(index){var prefab=this.prefabs[index],imgData=this.screenshot(prefab);this.prefabsBar.set(index,{imgData:imgData,index:index})},Editor.prototype.updateMaterial=function(blocks){for(var materials=blocks.material.materials,i=0;i<this.materials.length;i++)materials[i]=this.materials[i]},Editor.prototype.updateSize=function(size){this.blocks.setDim([size[0],size[1],size[2]]),this.blocks.obj.position.set(-size[0]/2,-size[1]/2,-size[2]/2),this.updateGround(size),this.updateBoundingBox(size);var maxSize=Math.max(size[0],size[1],size[2]);this.dragCamera.distance=2*maxSize,this.updateCurrentPrefab()},Editor.prototype.updateGround=function(size){null!=this.objGround&&this.object.remove(this.objGround);var geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3(-size[0]/2,-size[1]/2,-size[2]/2),new THREE.Vector3(size[0]/2,-size[1]/2,-size[2]/2),new THREE.Vector3(size[0]/2,-size[1]/2,size[2]/2),new THREE.Vector3(-size[0]/2,-size[1]/2,size[2]/2)),geometry.faces.push(new THREE.Face3(2,1,0),new THREE.Face3(0,3,2)),geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(size[2]/2,0),new THREE.Vector2(size[2]/2,size[0]/2)],[new THREE.Vector2(size[2]/2,size[0]/2),new THREE.Vector2(0,size[0]/2),new THREE.Vector2(0,0)]);var material=materials.placeholder;this.objGround=new THREE.Mesh(geometry,material),this.object.add(this.objGround)},Editor.prototype.updateBoundingBox=function(size){null!=this.objBoundingBox&&this.object.remove(this.objBoundingBox);var geometry=new THREE.Geometry,a=new THREE.Vector3(-size[0]/2,-size[1]/2,-size[2]/2),b=new THREE.Vector3(size[0]/2,-size[1]/2,-size[2]/2),c=new THREE.Vector3(size[0]/2,-size[1]/2,size[2]/2),d=new THREE.Vector3(-size[0]/2,-size[1]/2,size[2]/2),e=new THREE.Vector3(-size[0]/2,size[1]/2,-size[2]/2),f=new THREE.Vector3(size[0]/2,size[1]/2,-size[2]/2),g=new THREE.Vector3(size[0]/2,size[1]/2,size[2]/2),h=new THREE.Vector3(-size[0]/2,size[1]/2,size[2]/2);geometry.vertices.push(a,e,b,f,c,g,d,h,e,f,f,g,g,h,h,e);var material=new THREE.LineBasicMaterial({color:16777215,transparent:!0,opacity:.5});this.objBoundingBox=new THREE.LineSegments(geometry,material),this.object.add(this.objBoundingBox)},Editor.prototype.updateTool=function(){if(null!=this.tool&&null!=this.tool.dispose&&this.tool.dispose(),this.toolName===EditorTools.Pen)this.tool=new PenTool(this);else if(this.toolName===EditorTools.Sample)this.tool=new SampleTool(this);else if(this.toolName===EditorTools.Select)this.tool=new SelectTool(this);else if(this.toolName===EditorTools.Camera)this.tool=new CameraTool(this);else{if(this.toolName!==EditorTools.Fill)throw new Error("cannot make tool named: "+this.toolName);this.tool=new FillTool(this)}null!=this.tool.start&&this.tool.start()},Editor.prototype.drawSelection=function(){for(var blocks=this.blocks,i=0;i<this.selections.length;i++){var coord=this.selections[i];coord=coord.clone().add(new THREE.Vector3(.5,.5,.5));var localPoint=blocks.coordToPoint(coord),worldPoint=blocks.obj.localToWorld(localPoint),vector=worldPoint.project(this.camera);vector.x=Math.round((vector.x+1)*canvas.width/2),vector.y=Math.round((-vector.y+1)*canvas.height/2),this.context.fillStyle="#ffffff",this.context.fillRect(vector.x,vector.y,1,1)}},Editor.prototype.createNew=function(index){index=index||this.prefabs.length,this.blocks.clear();var prefab=this.blocks.serialize();this.prefabs.splice(index,0,prefab),this.updateScreenshotAtIndex(index),this.prefabIndex=index,this.prefabsBar.highlight(index),this.updatePropertyPanel(),this.updateLastBlocks()},Editor.prototype.removeSelected=function(){this.prefabs.splice(this.prefabIndex,1),0===this.prefabs.length&&(this.blocks.clear(),this.prefabs.push(this.blocks.serialize()),this.updatePropertyPanel()),this.prefabIndex>this.prefabs.length-1&&(this.prefabIndex=this.prefabs.length-1,this.prefabsBar.highlight(this.prefabIndex),this.blocks.deserialize(this.prefabs[this.prefabIndex]),this.updatePropertyPanel()),this.updateScreenshots(),this.updateLastBlocks()},Editor.prototype.createClone=function(){var prefab=this.blocks.serialize();this.createNew(this.prefabIndex+1),this.blocks.deserialize(prefab),this.updateCurrentPrefab(),this.updateScreenshots()},Editor.prototype.screenshot=function(data){null==this.screenshotRenderer&&(this.screenshotRenderer=new THREE.WebGLRenderer({alpha:!0}),this.screenshotRenderer.setClearColor(16777215,0));var renderer=this.screenshotRenderer,width=100,height=100;renderer.setSize(width,height);var object=new THREE.Object3D,blocks=new Blocks(object);blocks.deserialize(data),blocks.tick();var dim=blocks.dim;blocks.obj.position.set(-dim[0]/2,-dim[1]/2,-dim[2]/2);var objectClone=object.clone(),scene=new THREE.Scene;scene.add(objectClone);var ambient=new THREE.AmbientLight(new THREE.Color("rgb(60%, 60%, 60%)")),light=new THREE.DirectionalLight(16777215,.6);light.position.set(.8,1,.5),scene.add(light),scene.add(ambient);var maxSize=2*Math.max(dim[0],dim[1],dim[2]),camera=new THREE.OrthographicCamera(maxSize/-2,maxSize/2,maxSize/2,maxSize/-2,.1,1e3);camera.position.set(0,0,10);var cameraPosition=new THREE.Vector3(0,0,maxSize).applyEuler(new THREE.Euler(-Math.PI/4,0,0,"YXZ"));return camera.position.copy(cameraPosition),camera.lookAt(new THREE.Vector3),renderer.render(scene,camera),imgData=renderer.domElement.toDataURL(),renderer.dispose(),imgData},Editor.prototype.load=function(data){this.blocks.deserialize(data),this.updateSize(this.blocks.dim),this.updateLastBlocks(),this.updatePropertyPanel()},Editor.prototype.updatePropertyPanel=function(){var prefab=this.getSelectedPrefab();this.propertyPanel.controllers.name.setValue(prefab.userData.name||"unnamed");var dim=prefab.dim,formattedSize=dim.join(" ");this.propertyPanel.controllers.size.setValue(formattedSize)},Editor.prototype.reset=function(){this.prefabService.reset()},Editor.prototype.save=function(){this.prefabService.save(this.prefabs)},Editor.prototype.updateLastBlocks=function(){this.blocks.updateMesh(),this.lastBlocks=this.blocks.obj.clone(),this.lastBlocks.updateMatrixWorld()},Editor.prototype.getCoordAbove=function(point){point=point||this.input.mouse;var objects=[];return null!=this.lastBlocks&&objects.push(this.lastBlocks),null!=this.objGround&&objects.push(this.objGround),this.getCoord(objects,point,-this.sn)},Editor.prototype.getCoordBelow=function(point){point=point||this.input.mouse;var objects=[];null!=this.lastBlocks&&objects.push(this.lastBlocks);var coord=this.getCoord(objects,point,this.sn);return null==coord&&null!=this.objGround?this.getCoord([this.objGround],point,-this.sn):coord},Editor.prototype.getCoord=function(objects,atPoint,delta){var viewport=this.input.screenToViewport(atPoint),raycaster=new THREE.Raycaster;raycaster.setFromCamera(viewport,this.camera);var intersects=raycaster.intersectObjects(objects,!0);if(0===intersects.length)return void 0;var intersect=intersects[0],point=intersect.point,diff=point.clone().sub(this.camera.position);diff=diff.setLength(diff.length()+(delta||0)),point=this.camera.position.clone().add(diff);var localPoint=this.blocks.obj.worldToLocal(point),coord=this.blocks.pointToCoord(localPoint);return coord=new THREE.Vector3(Math.round(coord.x),Math.round(coord.y),Math.round(coord.z))},Editor.prototype.updateHighlight=function(coord){if(null==this.objHighlight){var geometry=new THREE.BoxGeometry(1,1,1),material=new THREE.MeshBasicMaterial,mesh=new THREE.Mesh(geometry,material),wireframe=new THREE.EdgesHelper(mesh,16777215);this.objHighlight=new THREE.Object3D,this.objHighlight.add(wireframe),this.object.add(this.objHighlight)}if(null==coord)return void(this.objHighlight.visible=!1);coord=coord.clone().add(new THREE.Vector3(.5,.5,.5)),this.objHighlight.visible=!0;var localPoint=this.blocks.coordToPoint(coord),worldPoint=this.blocks.obj.localToWorld(localPoint);this.objHighlight.position.copy(worldPoint)},Editor.prototype.setSelectedColor=function(color){var index=arrayUtils.indexOf(this.palette,function(c){return color===c||null==color&&c.isClearColor});-1!=index&&(this.selectedColor=color,this.colorBar.highlight(index))},Editor.prototype.applyOffset=function(offset){var selectedCoords;selectedCoords=this.selections.length>0?this.selections:this.blocks.getAllCoords(),this.runCommand(new OffsetCommand(this,this.blocks,selectedCoords,offset)),this.updateLastBlocks()},Editor.prototype.downloadJSON=function(json,name){name=name||"blocks";var dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(json));null==this.downloadElement&&(this.downloadElement=document.createElement("a"),this.downloadElement.style.visibility="hidden",document.body.appendChild(this.downloadElement)),this.downloadElement.setAttribute("href",dataStr),this.downloadElement.setAttribute("download",name+".json"),this.downloadElement.click()},Editor.prototype.serialize=function(){return this.blocks.serialize()},Editor.prototype.getSelectedPrefab=function(){return this.prefabs[this.prefabIndex]},Editor.prototype.updateCurrentPrefab=function(){this.prefabs[this.prefabIndex]=this.blocks.serialize()},module.exports=Editor}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../components/blocks":21,"../utils/arrayutils":59,"./commands/offsetcommand":31,"./dragcamera":34,"./editorconsole":36,"./editortools":37,"./gui/arrowbar":38,"./gui/colorbar":39,"./gui/filebar":41,"./gui/prefabsbar":44,"./gui/prefabstoolbar":45,"./gui/propertypanel":46,"./gui/toolbar":47,"./tools/cameratool":48,"./tools/filltool":49,"./tools/pentool":50,"./tools/sampletool":51,"./tools/selecttool":52,cbuffer:5}],36:[function(require,module){require("./editor");module.exports=function(editor,devConsole){devConsole.commands.size=function(args){var defaultSize=editor.config.editor_default_size,x=args._[0]||defaultSize[0],y=args._[1]||args._[0]||defaultSize[1],z=args._[2]||args._[0]||defaultSize[2];editor.updateSize([x,y,z])},devConsole.commands.offset=function(args){var x=args._[0]||0,y=args._[1]||0,z=args._[2]||0;editor.blocks.setOffset(new THREE.Vector3(x,y,z))},devConsole.commands["new"]=function(){editor.createNew()},devConsole.commands.mirror=function(args){if(0===args._.length)throw new Error("please specify x y z or none");1===args._.length&&"none"===args._[0]&&(editor.reflectX=editor.reflectY=editor.reflectZ=!1),editor.reflectX=editor.reflectY=editor.reflectZ=!1;for(var i=0;i<args._.length;i++){var arg=args._[i];if("x"===arg)editor.reflectX=!0;else if("y"===arg)editor.reflectY=!0;else{if("z"!==arg)throw new Error("unknown option: "+arg);editor.reflectZ=!0}}},devConsole.commands.reset=function(){editor.reset()},devConsole.commands.save=function(){editor.save()}}},{"./editor":35}],37:[function(require,module){var EditorTools={Pen:"Pen",Select:"Select",Sample:"Sample",Camera:"Camera",Fill:"Fill"};

module.exports=EditorTools},{}],38:[function(require,module){var cpr=require("./cpr");module.exports=function(editor){var data=[{src:"/images/icons/arrow1_light.png",srcActive:"/images/icons/arrow1_dark.png",index:0,tooltip:"move right (D)"},{src:"/images/icons/arrow2_light.png",srcActive:"/images/icons/arrow2_dark.png",index:1,tooltip:"move left (A)"},{src:"/images/icons/arrow3_light.png",srcActive:"/images/icons/arrow3_dark.png",index:2,tooltip:"move front (W)"},{src:"/images/icons/arrow4_light.png",srcActive:"/images/icons/arrow4_dark.png",index:3,tooltip:"move back (S)"},{src:"/images/icons/arrow5_light.png",srcActive:"/images/icons/arrow5_dark.png",index:4,tooltip:"move up (R)"},{src:"/images/icons/arrow6_light.png",srcActive:"/images/icons/arrow6_dark.png",index:5,tooltip:"move down (F)"}],bar=cpr({data:data,blockWidth:32,blockHeight:32,hideHighlight:!0,customPlacement:!0,showTooltip:!0,onPick:function(obj){var index=obj.index,offset=null;0===index?offset=new THREE.Vector3(1,0,0):1===index?offset=new THREE.Vector3(-1,0,0):2===index?offset=new THREE.Vector3(0,0,-1):3===index?offset=new THREE.Vector3(0,0,1):4===index?offset=new THREE.Vector3(0,1,0):5===index&&(offset=new THREE.Vector3(0,-1,0)),editor.applyOffset(offset)},isButton:!0}),gui=document.getElementById("gui");gui.appendChild(bar.domElement),bar.domElement.classList.add("toolbar"),bar.domElement.style.position="absolute",bar.domElement.style.top="70px",bar.domElement.style.left="20px"}},{"./cpr":40}],39:[function(require,module){var cpr=require("./cpr");module.exports=function(editor){var bar=cpr({data:editor.palette,onPick:function(color){editor.selectedColor=color.isClearColor?null:color},customPlacement:!0}),gui=document.getElementById("gui");return gui.appendChild(bar.domElement),bar.domElement.style.position="absolute",bar.domElement.style.left="20px",bar.domElement.style.bottom="20px",bar}},{"./cpr":40}],40:[function(require,module){module.exports=function(opts){function getRow(index){return Math.floor(index/columns)}function getColumn(index){return index%columns}function getRows(){return Math.ceil(data.length/columns)}function getIndex(row,column){return row*columns+column}function remove(index){container.removeChild(blocks[index]),blocks[index].removeEventListener("mousedown",mousedownListeners[index]),blocks[index].removeEventListener("mouseup",mouseupListeners[index]),mousedownListeners[index]=void 0,mouseupListeners[index]=void 0,blocks[index]=void 0,data[index]=void 0}function set(index,obj){null!=data[index]&&remove(index);var element,row=getRow(index),column=getColumn(index);if(null!=obj.imgData)element=document.createElement("img"),element.src=obj.imgData;else if(null!=obj.src)element=document.createElement("img"),element.src=obj.src;else{var color=obj;element=document.createElement("div"),element.style.backgroundColor=color}element.className="block box-sizing",isButton&&element.classList.add("button"),container.appendChild(element),position(element,row,column),blocks[index]=element,data[index]=obj,updateContainer(),skinBlock(element);var onMouseDown=function(){highlight(index,!0),onPick(obj,index)},onMouseUp=function(){isButton&&!stickySelection&&highlight(index,!1)};element.addEventListener("mousedown",onMouseDown),element.addEventListener("mouseup",onMouseUp),mousedownListeners[index]=onMouseDown,mouseupListeners[index]=onMouseUp}function add(obj){var index=blocks.length;set(index,obj)}function position(element,row,column){element.style.position="absolute",element.style.left=column*(blockWidth+paddingRight)+"px",element.style.top=row*blockHeight+"px",element.style.width=blockWidth+"px",element.style.height=blockHeight+"px"}function updateContainer(){var numberOfColumns=data.length>columns?columns:data.length;container.style.width=numberOfColumns*(blockWidth+paddingRight)+"px",container.style.height=getRows()*blockHeight+"px"}function highlight(index,value){value=void 0===value?!0:value;var element=blocks[index];if(null!=element){var obj=data[index];if(value){if(isButton)stickySelection&&selectedIndex!=index&&highlight(selectedIndex,!1),element.classList.add("selected"),null!=obj.srcActive&&(element.src=obj.srcActive);else{var row=getRow(index),column=getColumn(index);null==highlightDiv&&(highlightDiv=document.createElement("div"),highlightDiv.className="highlight",highlightDiv.style.position="absolute",highlightDiv.style.width=blockWidth+"px",highlightDiv.style.height=blockHeight+"px",highlightDiv.style.zIndex=1,container.appendChild(highlightDiv)),highlightDiv.style.left=column*(blockWidth+paddingRight)-1+"px",highlightDiv.style.top=row*blockHeight-1+"px"}selectedIndex=index}else isButton&&(element.classList.remove("selected"),element.src=obj.src)}}function clear(){for(var i=0;i<data.length;i++)remove(i);data=[]}function isDescendant(parent,child){if(null==child)return!1;for(var node=child.parentNode;null!=node;){if(node==parent)return!0;node=node.parentNode}return!1}opts=opts||{};var dataToLoad=opts.data||[],onPick=opts.onPick||function(){},onHover=opts.onHover||function(){},onLeave=opts.onLeave||function(){},customPlacement=opts.customPlacement||!1,showTooltip=opts.showTooltip||!1,paddingRight=opts.paddingRight||0,blockWidth=opts.blockWidth||20,blockHeight=opts.blockHeight||20,columns=opts.columns||14,isButton=opts.isButton||!1,skinBlock=opts.skinBlock||function(){},stickySelection=opts.stickySelection||!1,container=document.createElement("div");container.className="cpr";var mousedownListeners=[],mouseupListeners=[],blocks=[],data=[],highlightDiv=null,selectedIndex=-1;if(showTooltip){var tooltip=document.createElement("div");tooltip.className="tooltip",tooltip.style.position="absolute",tooltip.style.visibility="hidden",container.appendChild(tooltip)}customPlacement||(container.style.position="absolute",container.style.left="20px",container.style.bottom="20px",document.body.appendChild(container)),container.onfocus=function(){container.style.outline="none"};for(var i=0;i<dataToLoad.length;i++)add(dataToLoad[i]);updateContainer();var mouse=null;return container.addEventListener("mousemove",function(e){mouse=e;var mouseX=e.pageX-container.offsetLeft,mouseY=e.pageY-container.offsetTop,row=Math.floor(mouseY/blockHeight),column=Math.floor(mouseX/blockWidth),index=getIndex(row,column);if(null!=data[index]){var obj=data[index];onHover(obj,index),showTooltip&&null!=obj.tooltip&&(tooltip.style.visibility="visible",tooltip.style.left=mouseX+2+"px",tooltip.style.top=mouseY+2+"px",tooltip.innerHTML!==obj.tooltip&&(tooltip.innerHTML=obj.tooltip))}}),container.addEventListener("mouseleave",function(e){isDescendant(container,e.toElement)||(onLeave(e),showTooltip&&(tooltip.style.visibility="hidden"))}),{highlight:highlight,add:add,set:set,clear:clear,data:data,domElement:container,get selectedIndex(){return selectedIndex},get mouse(){return mouse},get tooltip(){return tooltip}}}},{}],41:[function(require,module){{var cpr=require("./cpr");require("./popup")}module.exports=function(editor){var data=[{src:"/images/icons/undo_light.png",srcActive:"/images/icons/undo_dark.png",button:"undo",tooltip:"Undo (ctrl + z)"},{src:"/images/icons/redo_light.png",srcActive:"/images/icons/redo_dark.png",button:"redo",tooltip:"Redo (shift + ctrl + z)"},{src:"/images/icons/download_light.png",srcActive:"/images/icons/download_dark.png",button:"save",tooltip:"Save in browser"}],bar=cpr({data:data,customPlacement:!0,blockWidth:32,blockHeight:32,hideHighlight:!0,showTooltip:!0,onPick:function(obj){var button=obj.button;"save"===button?editor.save():"undo"===button?editor.undo():"redo"===button&&editor.redo()},isButton:!0}),gui=document.getElementById("gui");gui.appendChild(bar.domElement),bar.domElement.classList.add("toolbar"),bar.domElement.style.position="absolute",bar.domElement.style.left="20px",bar.domElement.style.top="120px"}},{"./cpr":40,"./popup":43}],42:[function(require,module){module.exports=function(data,opts){var customPlacement=opts.customPlacement||!1,container=document.createElement("div");container.className="panel",customPlacement||(container.style.position="absolute",container.style.right="40px",container.style.top="20px",container.style.width="200px",document.body.appendChild(container));var panel={};panel.controllers={},panel.domElement=container;for(var controllers={checkList:checkListController},i=0;i<data.length;i++){var item=data[i],factory=controllers[item.type]||valueController,controller=factory(item);panel.controllers[item.title]=controller,container.appendChild(controller.element)}return panel};var valueController=function(item){function setValue(value){input.value=value}function dispose(){input.removeEventListener("input",inputListener),input.removeEventListener("keydown",keydownListener)}var onChange=item.onChange||function(){},onFinishEditing=item.onFinishEditing||function(){},section=document.createElement("section");section.className="section";var title=document.createElement("div");title.innerHTML=item.title,title.className="title",section.appendChild(title);var input=document.createElement("input");input.type="text",input.value=item.value,input.className="text-field",section.appendChild(input);var inputListener=function(){onChange(input.value)},keydownListener=function(e){13===e.keyCode&&input.blur()};return input.addEventListener("input",inputListener),input.addEventListener("keydown",keydownListener),input.onblur=function(){onFinishEditing(input.value,input)},{element:section,setValue:setValue,set onChange(value){onChange=value},dispose:dispose}},checkListController=function(item){function getSelectedOptions(){for(var selection=[],i=0;i<buttons.length;i++)buttons[i].classList.contains("selected")&&selection.push(options[i]);return selection}var onChange=item.onChange||function(){},section=document.createElement("section");section.className="section";var title=document.createElement("div");title.innerHTML=item.title,title.className="title",section.appendChild(title);for(var options=item.options,buttons=[],onClick=function(index){return function(){var button=buttons[index];button.classList.toggle("selected"),onChange(getSelectedOptions())}},i=0;i<options.length;i++){var option=options[i],button=document.createElement("button");button.className="segmented-button",button.innerHTML=option,section.appendChild(button),i===options.length-1&&(button.style["border-right-style"]="2px solid #000"),button.onclick=onClick(i),buttons.push(button)}return{element:section}}},{}],43:[function(require,module){module.exports={prompt:function(opts,callback){function onWindowResize(){updateLayout()}function onClick(index){return function(){var shouldDismiss=callback(index);void 0===shouldDismiss&&(shouldDismiss=!0),shouldDismiss&&dismiss()}}function updateLayout(){container.style.left=(window.innerWidth-containerWidth)/2+"px",container.style.top=(window.innerHeight-containerHeight)/2+"px"}function dismiss(){document.body.removeChild(background),window.removeEventListener("resize",onWindowResize)}var text=opts.text,buttons=opts.buttons||["OK"],containerWidth=opts.containerWidth||200,containerHeight=opts.containerHeight||200,background=document.createElement("div");background.style.backgroundColor="rgba(0,0,0,0.8)",background.style.position="absolute",background.style.width="100%",background.style.height="100%",document.body.appendChild(background),containerWidth=200,containerHeight=200;var container=document.createElement("div");container.className="prompt",container.style.position="absolute",container.style.width=containerWidth+"px",background.appendChild(container),updateLayout(),window.addEventListener("resize",onWindowResize);var question=document.createElement("h2");question.innerHTML=text,question.style.fontFamily="",container.appendChild(question);for(var i=0;i<buttons.length;i++){var buttonText=buttons[i],button=document.createElement("button");button.innerHTML=buttonText,button.onclick=onClick(i),container.appendChild(button)}var prompt={dismiss:dismiss};return prompt}}},{}],44:[function(require,module){var cpr=require("./cpr");module.exports=function(editor){var bar=cpr({onPick:function(obj,index){editor.prefabIndex=index,editor.load(editor.prefabs[index])},blockWidth:48,blockHeight:48,customPlacement:!0}),gui=document.getElementById("gui");return gui.appendChild(bar.domElement),bar.domElement.style.position="absolute",bar.domElement.style.left="20px",bar.domElement.style.bottom="120px",bar}},{"./cpr":40}],45:[function(require,module){var cpr=require("./cpr"),popup=require("./popup");module.exports=function(editor){var data=(editor.input,[{button:"plus",src:"/images/icons/plus_light.png",srcActive:"/images/icons/plus_dark.png",tooltip:"Create new"},{button:"minus",src:"/images/icons/minus_light.png",srcActive:"/images/icons/minus_dark.png",tooltip:"Remove selected"},{button:"clone",src:"/images/icons/clone_light.png",srcActive:"/images/icons/clone_dark.png",tooltip:"Clone selected"}]),bar=cpr({data:data,blockWidth:32,blockHeight:32,disableHighlight:!0,showTooltip:!0,onPick:function(obj){var button=obj.button;"plus"===button?editor.createNew():"minus"===button?(popup.prompt({text:"Are you sure?",buttons:["Yea","Na"]},function(index){0===index&&editor.removeSelected()}),bar.highlight(1,!1)):"clone"===button&&editor.createClone()},customPlacement:!0,isButton:!0}),gui=document.getElementById("gui");gui.appendChild(bar.domElement),bar.domElement.style.position="absolute",bar.domElement.style.left="20px",bar.domElement.style.bottom="180px"}},{"./cpr":40,"./popup":43}],46:[function(require,module){function clamp(value,min,max){return min>value?min:value>max?max:value}var panel=require("./panel");module.exports=function(editor){var data=[{title:"name",value:"",onChange:function(value){editor.getSelectedPrefab().userData.name=value}},{title:"size",value:"",onFinishEditing:function(value){var reg=/^\s*(\d{1,2}) (\d{1,2}) (\d{1,2})\s*$/g,matches=reg.exec(value);return null==matches?void editor.updatePropertyPanel():(editor.updateSize([clamp(parseInt(matches[1]),0,32),clamp(parseInt(matches[2]),0,32),clamp(parseInt(matches[3]),0,32)]),void editor.updatePropertyPanel())}},{title:"mirror",type:"checkList",options:["x","y","z"],onChange:function(options){editor.reflectX=editor.reflectY=editor.reflectZ=!1;for(var i=0;i<options.length;i++)"x"===options[i]?editor.reflectX=!0:"y"===options[i]?editor.reflectY=!0:"z"===options[i]&&(editor.reflectZ=!0)}}],propertyPanel=panel(data,{customPlacement:!0});return propertyPanel.domElement.style.position="absolute",propertyPanel.domElement.style.right="40px",propertyPanel.domElement.style.top="20px",propertyPanel.domElement.style.width="200px",document.getElementById("gui").appendChild(propertyPanel.domElement),propertyPanel}},{"./panel":42}],47:[function(require,module){var cpr=require("./cpr"),EditorTools=require("../editortools");module.exports=function(editor){var bar=cpr({data:[{src:"/images/icons/pencil_light.png",srcActive:"/images/icons/pencil_dark.png",toolname:EditorTools.Pen,tooltip:"pen tool (1)"},{src:"/images/icons/sampler_light.png",srcActive:"/images/icons/sampler_dark.png",toolname:EditorTools.Sample,tooltip:"sample tool (2)"},{src:"/images/icons/lasso_light.png",srcActive:"/images/icons/lasso_dark.png",toolname:EditorTools.Select,tooltip:"lasso tool (3)"},{src:"/images/icons/camera_light.png",srcActive:"/images/icons/camera_dark.png",toolname:EditorTools.Camera,tooltip:"camera tool (4 or drag empty space)"},{src:"/images/icons/fill_light.png",srcActive:"/images/icons/fill_dark.png",toolname:EditorTools.Fill,tooltip:"block tool (5) (drag and drop between two points)"}],blockWidth:32,blockHeight:32,onPick:function(obj){editor.toolName=obj.toolname,editor.updateTool()},customPlacement:!0,showTooltip:!0,hideHighlight:!0,isButton:!0,stickySelection:!0}),gui=document.getElementById("gui");return gui.appendChild(bar.domElement),bar.domElement.classList.add("toolbar"),bar.domElement.style.position="absolute",bar.domElement.style.top="20px",bar.domElement.style.left="20px",bar}},{"../editortools":37,"./cpr":40}],48:[function(require,module){var CameraTool=function(){};CameraTool.prototype.tick=function(){},module.exports=CameraTool},{}],49:[function(require,module){var SetCommand=require("../commands/setcommand"),FillTool=function(editor){this.editor=editor,this.input=this.editor.input,this.blocksCopy=null,this.startCoord=null,this.endCoord=null};FillTool.prototype.start=function(){this.editor.updateLastBlocks()},FillTool.prototype.tick=function(){var coordAbove=this.editor.getCoordAbove(),coordBelow=this.editor.getCoordBelow(),shouldUpdate=!1,isRemove=this.input.mouseHold(2)||this.input.mouseUp(2);this.editor.highlightCoord=null==this.editor.selectedColor?coordBelow:coordAbove;var coord=isRemove||null==this.editor.selectedColor?coordBelow:coordAbove;this.input.mouseDown()&&null!=coord&&(this.blocksCopy=this.editor.blocks.serialize(),null==this.startCoord&&(this.startCoord=coord,this.endCoord=coord,shouldUpdate=!0)),null!=this.startCoord&&null!=coord&&(null!=this.endCoord&&this.endCoord.equals(coord)||(this.endCoord=coord,shouldUpdate=!0));var index=isRemove?0:this.editor.blocks.getOrAddColorIndex(this.editor.selectedColor);if(null!=this.startCoord&&null!=this.endCoord&&shouldUpdate){this.editor.blocks.deserialize(this.blocksCopy);var self=this;this.loopCoords(this.startCoord,this.endCoord,function(i,j,k){self.editor.blocks.set(i,j,k,index)})}if(this.input.mouseUp()&&null!=this.blocksCopy){this.editor.blocks.deserialize(this.blocksCopy);var coords=[];this.loopCoords(this.startCoord,this.endCoord,function(i,j,k){coords.push(new THREE.Vector3(i,j,k))});var command=new SetCommand(this.editor.blocks,coords,index);this.editor.runCommand(command),this.editor.updateLastBlocks(),this.startCoord=null,this.endCoord=null,this.blocksCopy=null}},FillTool.prototype.loopCoords=function(startCoord,endCoord,callback){for(var min=new THREE.Vector3(Math.min(startCoord.x,endCoord.x),Math.min(startCoord.y,endCoord.y),Math.min(startCoord.z,endCoord.z)),max=new THREE.Vector3(Math.max(startCoord.x,endCoord.x),Math.max(startCoord.y,endCoord.y),Math.max(startCoord.z,endCoord.z)),i=min.x;i<=max.x;i++)for(var j=min.y;j<=max.y;j++)for(var k=min.z;k<=max.z;k++)callback(i,j,k)},module.exports=FillTool},{"../commands/setcommand":33}],50:[function(require,module){function uniqueCoords(coords){for(var map={},i=0;i<coords.length;i++)map[coords[i].toArray().join(",")]=coords[i];var list=[];for(var id in map)list.push(map[id]);return list}var SetCommand=require("../commands/setcommand"),PenTool=function(editor){this.editor=editor,this.camera=this.editor.camera,this.input=this.editor.input,this.blocks=this.editor.blocks,this.object=this.editor.object,this.lastMouse=new THREE.Vector2,this.mouseSampleInterval=4};PenTool.prototype.tick=function(){if(!this.editor.editLock){var isClearColor=null==this.editor.selectedColor;this.editor.highlightCoord=isClearColor?this.editor.getCoordBelow():this.editor.getCoordAbove(),(this.input.mouseDown()||this.input.mouseUp())&&this.editor.updateLastBlocks(),this.input.mouseDown(0)?this.onClick(isClearColor):this.input.mouseDown(2)&&this.onClick(!0),this.input.mouseHold(0)&&this.input.mouseMove()?this.onDrag(isClearColor):this.input.mouseHold(2)&&this.input.mouseMove()&&this.onDrag(!0),this.lastMouse=this.input.mouse.clone()}},PenTool.prototype.onClick=function(isClear){var color=isClear?null:this.editor.selectedColor,selectedIndex=this.blocks.getOrAddColorIndex(color),coord=isClear?this.editor.getCoordBelow():this.editor.getCoordAbove();coord&&this.blocks.getAtCoord(coord)!==selectedIndex&&(this.editor.runCommand(new SetCommand(this.blocks,this.reflectCoords([coord]),selectedIndex)),this.editor.updateLastBlocks())},PenTool.prototype.onDrag=function(isClear){for(var color=isClear?null:this.editor.selectedColor,selectedIndex=this.blocks.getOrAddColorIndex(color),points=this.getMousePoints(this.lastMouse,this.input.mouse,this.mouseSampleInterval),coords=[],i=0;i<points.length;i++){var coord=isClear?this.editor.getCoordBelow(points[i]):this.editor.getCoordAbove(points[i]);coord&&this.blocks.getAtCoord(coord)!==selectedIndex&&coords.push(coord)}coords=uniqueCoords(coords),coords.length>0&&this.editor.runCommand(new SetCommand(this.blocks,this.reflectCoords(coords),selectedIndex))},PenTool.prototype.reflectCoords=function(coords){if(!this.editor.reflectX&&!this.editor.reflectY&&!this.editor.reflectZ)return coords;var dim=this.blocks.dim,pivot=[Math.round((dim[0]-1)/2),Math.round((dim[1]-1)/2),Math.round((dim[2]-1)/2)];if(this.editor.reflectX){for(var reflected=[],i=0;i<coords.length;i++){var r=coords[i].clone();r.x=pivot[0]+pivot[0]-r.x,reflected.push(r)}coords=coords.concat(reflected)}if(this.editor.reflectY){for(var reflected=[],i=0;i<coords.length;i++){var r=coords[i].clone();r.y=pivot[1]+pivot[1]-r.y,reflected.push(r)}coords=coords.concat(reflected)}if(this.editor.reflectZ){for(var reflected=[],i=0;i<coords.length;i++){var r=coords[i].clone();r.z=pivot[2]+pivot[2]-r.z,reflected.push(r)}coords=coords.concat(reflected)}return coords},PenTool.prototype.getMousePoints=function(from,to,maxDis){var distance=(new THREE.Vector2).subVectors(to,from).length(),interval=Math.ceil(distance/maxDis),step=(new THREE.Vector2).subVectors(to,from).setLength(distance/interval),list=[],start=from.clone();list.push(start);for(var i=0;interval>i;i++)start.add(step),list.push(start.clone());return list},module.exports=PenTool},{"../commands/setcommand":33}],51:[function(require,module){var SampleTool=(require("../editortools"),function(editor){this.editor=editor,this.input=this.editor.input,this.blocks=this.editor.blocks});SampleTool.prototype.tick=function(){if(this.editor.highlightCoord=this.editor.getCoordBelow(),this.input.mouseDown()){var coord=this.editor.getCoordBelow(),color=null;if(null!=coord){var index=this.blocks.getAtCoord(coord),color=this.blocks.palette[index];this.editor.setSelectedColor(color)}else this.editor.setSelectedColor(null)}},module.exports=SampleTool},{"../editortools":37}],52:[function(require,module){var inside=require("point-in-polygon"),SelectCommand=require("../commands/selectcommand"),SelectTool=function(editor){this.editor=editor,this.input=this.editor.input,this.blocks=this.editor.blocks,this.camera=this.editor.camera,this.divSelectionBox=null,this.canvas=editor.canvas,this.context=this.canvas.getContext("2d"),this.points=[],this.minDistance=2};SelectTool.prototype.tick=function(){if(this.input.mouseHold(0)){var mouse=this.input.mouse.clone();if(0===this.points.length)this.points.push(mouse.toArray());else{var lastMouse=(new THREE.Vector2).fromArray(this.points[this.points.length-1]),distance=lastMouse.distanceTo(mouse);distance>this.minDistance&&this.points.push(mouse.toArray())}}else this.points.length>0&&this.updateSelection(),this.points=[];this.drawLasso()},SelectTool.prototype.drawLasso=function(){if(!(this.points.length<2)){this.context.lineWidth="1",this.context.setLineDash([3]),this.context.strokeStyle="#ffffff",this.context.beginPath();for(var i=0;i<this.points.length;i++){var point=this.points[i];0===i?this.context.moveTo(point[0],point[1]):this.context.lineTo(point[0],point[1])}this.context.stroke()}},SelectTool.prototype.updateSelection=function(){var blocks=this.blocks,camera=this.camera,canvas=this.canvas,screenPoints=[];this.blocks.visit(function(i,j,k){var coord=new THREE.Vector3(i+.5,j+.5,k+.5),localPoint=blocks.coordToPoint(coord),worldPoint=blocks.obj.localToWorld(localPoint),vector=worldPoint.project(camera);vector.x=Math.round((vector.x+1)*canvas.width/2),vector.y=Math.round((-vector.y+1)*canvas.height/2),screenPoints.push({screen:[vector.x,vector.y],coord:new THREE.Vector3(i,j,k)})});for(var selections=[],i=0;i<screenPoints.length;i++){var screen=screenPoints[i].screen;inside(screen,this.points)&&selections.push(screenPoints[i].coord)}this.editor.runCommand(new SelectCommand(this.editor,selections))},module.exports=SelectTool},{"../commands/selectcommand":32,"point-in-polygon":17}],53:[function(require){(function(global){function loadEditor(){app.loadAssembly(require("./assemblies/aeditor"))}var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,b=require("./core/b"),app=b("main"),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3);app.value("app",app),app.value("scene",scene),app.value("camera",camera),app.value("config",require("./data/config.json")),app.value("palette",require("./data/palette.json")),app.value("materials",require("./services/materials")),app.value("canvas",document.getElementById("canvas"));var container=document.getElementById("container");app.use(require("./systems/renderer")(scene,camera,container)),app.use("input",require("./systems/input")(container)),app.use(require("./voxel/voxel")());var devConsole=require("./services/devconsole")({onblur:function(){container.focus()}});app.value("devConsole",devConsole);var prefabService=require("./services/prefabservice")();app.value("prefabService",prefabService),loadEditor(),app.start();var canvas=document.getElementById("canvas");app.on("beforeTick",function(){canvas.width!==window.innerWidth&&(canvas.width=window.innerWidth),canvas.height!==window.innerHeight&&(canvas.height=window.innerHeight)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./assemblies/aeditor":18,"./assemblies/aground":19,"./assemblies/aplayer":20,"./components/playerCamera":23,"./core/b":26,"./data/config.json":28,"./data/palette.json":29,"./services/devconsole":54,"./services/materials":55,"./services/prefabservice":56,"./systems/input":57,"./systems/renderer":58,"./voxel/voxel":63}],54:[function(require,module){var parseArgs=require("minimist"),keycode=require("keycode");module.exports=function(opts){function onInputChanged(){input.value.length<2&&(input.value="> ")}function onEnterPressed(){var line=input.value;addLog(line),line=line.substring(2),line=line.trim();var index=line.indexOf(" "),commandName=-1===index?line:line.substring(0,index),args=-1===index?"":line.substring(index+1),command=commands[commandName];if(null==command)addError(commandName+": command not found");else try{var result=command(parseArgs(args.split(" ")));"string"==typeof result&&addLog(result),hide()}catch(err){addError(err),console.error(err.stack)}input.value=""}function addLog(line){addLine(line)}function addError(line){addLine(line)}function addLine(line){lines.push(line),lines.length>historyLength&&lines.pop(),updateLines()}function updateLines(){for(var text="",i=0;numberOfLines>i;i++){var line=lines[lines.length-1-i];line=line||"",text+=line,text+="<br />"}textSpan.innerHTML=text}function hide(){div.hidden=!0,input.blur(),null!=onblur&&onblur()}function show(){div.hidden=!1,input.value=input.value.split("`").join(""),input.focus(),null!=onfocus&&onfocus()}function loadCommands(value){for(var i in value)commands[i]=value[i]}opts=opts||{};var onfocus=opts.onfocus||null,onblur=opts.onblur||null,commands=opts.commands||{},div=document.createElement("div");document.body.appendChild(div),div.style.position="absolute",div.style.left="0px",div.style.top="0px",div.style.width="100%",div.style.height="120px",div.style.backgroundColor="rgba(0, 0, 0, 0.5)";var input=document.createElement("input");input.type="text",input.className="console-input",input.style.position="absolute",input.style.left="0px",input.style.top="0px",input.style.width="100%",input.style.height="20px",input.style["background-color"]="transparent",input.style.border="0px solid",input.spellcheck=!1,input.style.color="#FFFFFF",input.style.fontSize="16px",input.style.padding="2px 2px 0px 2px",input.value="> ",div.appendChild(input);var textSpan=document.createElement("span");textSpan.className="console-span",textSpan.style.position="absolute",textSpan.style.left="0px",textSpan.style.top="20px",textSpan.style.width="100%",textSpan.style.height="100px",textSpan.style.color="#FFFFFF",textSpan.style.fontSize="16px",textSpan.style.padding="0px 2px 2px 2px",div.appendChild(textSpan),input.onfocus=function(){input.style.outline="none"},input.onkeypress=function(e){13===e.keyCode&&onEnterPressed(),onInputChanged(e)},input.onkeyup=function(e){onInputChanged(e)};var lines=[],historyLength=100,numberOfLines=5;return window.addEventListener("keyup",function(e){var key=keycode(e);"`"===key&&(div.hidden?show():hide())}),div.hidden=!0,{commands:commands,loadCommands:loadCommands}}},{keycode:12,minimist:13}],55:[function(require,module){(function(global){function loadBasicMaterial(source){var texture=textureLoader.load(source);return texture.wrapS=THREE.RepeatWrapping,texture.wrapT=THREE.RepeatWrapping,texture.magFilter=THREE.NearestFilter,new THREE.MeshBasicMaterial({map:texture})}var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,textureLoader=new THREE.TextureLoader;materials={placeholder:loadBasicMaterial("images/placeholder.png")},module.exports=materials}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(require,module){var PrefabService=function(){};PrefabService.prototype.load=function(){try{var saves=JSON.parse(window.localStorage.getItem("b_saves")||[]);return saves}catch(err){return[]}},PrefabService.prototype.save=function(data){window.localStorage.setItem("b_saves",JSON.stringify(data))},PrefabService.prototype.reset=function(){window.localStorage.setItem("b_saves","")},module.exports=function(){return new PrefabService}},{}],57:[function(require,module){var arrayUtils=require("../utils/arrayutils"),keycode=require("keycode");module.exports=function(element){"use strict";function onMouseMove(e){mousemove=!0,mouse.x=e.clientX,mouse.y=e.clientY}function onMouseDown(e){mousedowns.push(e.button),mousedownTimes[e.button]=(new Date).getTime(),arrayUtils.includes(mouseholds,e.button)||mouseholds.push(e.button)}function onMouseUp(e){if(mousedownTimes[e.button]){var diff=(new Date).getTime()-mousedownTimes[e.button];clickTime>diff&&mouseclicks.push(e.button)}mouseups.push(e.button),arrayUtils.remove(mouseholds,e.button)}function onKeyDown(e){var key=keycode(e);keydowns.push(key),arrayUtils.includes(keyholds,key)||keyholds.push(key)}function onKeyUp(e){var key=keycode(e);keyups.push(key),arrayUtils.remove(keyholds,key)}function clear(){mousedowns=[],mouseups=[],mousemove=!1,keydowns=[],keyups=[],mouseclicks=[]}var mouse=new THREE.Vector2,mousedowns=[],mouseups=[],mousemove=!1,mouseholds=[],keydowns=[],keyups=[],keyholds=[],mousedownTimes={},clickTime=150,mouseclicks=[];return element.focus(),element.addEventListener("mousedown",onMouseDown),element.addEventListener("mousemove",onMouseMove),element.addEventListener("mouseup",onMouseUp),element.addEventListener("keydown",onKeyDown),element.addEventListener("keyup",onKeyUp),{mouse:mouse,mouseDown:function(button){return void 0===button?mousedowns.length>0:arrayUtils.includes(mousedowns,button)},mouseUp:function(button){return void 0===button?mouseups.length>0:arrayUtils.includes(mouseups,button)},mouseHold:function(button){return void 0===button?mouseholds.length>0:arrayUtils.includes(mouseholds,button)},mouseClick:function(button){return void 0===button?mouseclicks.length>0:arrayUtils.includes(mouseclicks,button)},keyDown:function(key){return void 0===key?keydowns.length>0:arrayUtils.includes(keydowns,key)},keyUp:function(key){return void 0===key?keyups.length>0:arrayUtils.includes(keyups,key)},keyHold:function(key){return void 0===key?keyholds.length>0:arrayUtils.includes(keyholds,key)},mouseMove:function(){return mousemove},lateTick:function(){clear()},screenToViewport:function(screen){var viewport=new THREE.Vector2;return viewport.x=screen.x/window.innerWidth*2-1,viewport.y=2*-(screen.y/window.innerHeight)+1,viewport}}}},{"../utils/arrayutils":59,keycode:12}],58:[function(require,module){module.exports=function(scene,camera,container){function render(){requestAnimationFrame(render),
ssao?(scene.overrideMaterial=depthMaterial,renderer.render(scene,camera,depthRenderTarget,!0),scene.overrideMaterial=null,effectComposer.render()):renderer.render(scene,camera)}function onWindowResize(){var width=window.innerWidth,height=window.innerHeight;camera.aspect=width/height,camera.updateProjectionMatrix(),renderer.setSize(width,height),ssaoPass.uniforms.size.value.set(width,height);var pixelRatio=renderer.getPixelRatio(),newWidth=Math.floor(width/pixelRatio)||1,newHeight=Math.floor(height/pixelRatio)||1;depthRenderTarget.setSize(newWidth,newHeight),effectComposer.setSize(newWidth,newHeight)}function initPostprocessing(){var renderPass=new THREE.RenderPass(scene,camera),depthShader=THREE.ShaderLib.depthRGBA,depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms);depthMaterial=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms,blending:THREE.NoBlending});var pars={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter};depthRenderTarget=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,pars),ssaoPass=new THREE.ShaderPass(THREE.SSAOShader),ssaoPass.renderToScreen=!0,ssaoPass.uniforms.tDepth.value=depthRenderTarget,ssaoPass.uniforms.size.value.set(window.innerWidth,window.innerHeight),ssaoPass.uniforms.cameraNear.value=camera.near,ssaoPass.uniforms.cameraFar.value=camera.far,ssaoPass.uniforms.onlyAO.value=!1,ssaoPass.uniforms.aoClamp.value=1,ssaoPass.uniforms.lumInfluence.value=.5,effectComposer=new THREE.EffectComposer(renderer),effectComposer.addPass(renderPass),effectComposer.addPass(ssaoPass)}var renderer=new THREE.WebGLRenderer;renderer.setClearColor(2236962),renderer.setSize(window.innerWidth,window.innerHeight),container=container||document.body,container.appendChild(renderer.domElement);var renderer,camera,ssaoPass,effectComposer,system={};system.renderer=renderer;var ssao=!0,ambient=new THREE.AmbientLight(new THREE.Color("rgb(60%, 60%, 60%)")),light=new THREE.DirectionalLight(16777215,.6);return light.position.set(.8,1,.5),scene.add(light),scene.add(ambient),initPostprocessing(),render(),window.addEventListener("resize",onWindowResize,!1),system}},{}],59:[function(require,module){var array={indexOf:function(array,element){for(var predicate="function"==typeof element?element:function(v){return v===element},i=0;i<array.length;i++)if(predicate(array[i]))return i;return-1},includes:function(array,element){return-1!==this.indexOf(array,element)},remove:function(array,element){var index=this.indexOf(array,element);-1!==index&&array.splice(index,1)},clone:function(array){for(var copy=[],i=0;i<array.length;i++)copy[i]=array[i];return copy}};module.exports=array},{}],60:[function(require,module){var Gravity=function(dir,axis,positive){this.dir=dir||new THREE.Vector3,this.axis=axis||"",this.positive=positive||"",this.clone=function(){return new Gravity(this.dir,this.axis,this.positive)},this.equals=function(gravity){return this.dir.equals(gravity.dir)},this.isNone=function(){return 0===this.dir.length()}};module.exports=Gravity},{}],61:[function(require,module){var Gravity=require("./gravity"),gravities={none:new Gravity,right:new Gravity(new THREE.Vector3(1,0,0).normalize(),"x",!0),left:new Gravity(new THREE.Vector3(-1,0,0).normalize(),"x",!1),top:new Gravity(new THREE.Vector3(0,1,0).normalize(),"y",!0),bottom:new Gravity(new THREE.Vector3(0,-1,0).normalize(),"y",!1),front:new Gravity(new THREE.Vector3(0,0,1).normalize(),"z",!0),back:new Gravity(new THREE.Vector3(0,0,-1).normalize(),"z",!1)};module.exports={getGravity:function(position){var min=1,closest=null,force=new THREE.Vector3;for(var id in gravities){var gravity=gravities[id],dot=gravity.dir.clone().dot(position.clone().normalize());if(min>dot&&(min=dot,closest=gravity),-.5>dot){var ratio=-.5-dot;force.add(gravity.dir.clone().multiplyScalar(ratio))}}var gravity=closest.clone();return gravity.forceDir=force.normalize(),gravity}}},{"./gravity":60}],62:[function(require,module){var compileMesher=require("greedy-mesher"),ndarray=require("ndarray"),mesher=compileMesher({extraArgs:1,order:[0,1],append:function(lo_x,lo_y,hi_x,hi_y,val,result){result.push([[lo_x,lo_y],[hi_x,hi_y]])}});module.exports=function(data,dim,voxelSideTextureIds){function processSlice(i){var slice=ndarray([],[dimsU,dimsV]),s0=0;dv=flip?i:i+1;for(var j=0;dimsU>j;j++){for(var s1=0,k=0;dimsV>k;k++){var b=getVoxel(i,j,k,d);if(b){var b1;if(b1=flip?0===i?0:getVoxel(i-1,j,k,d):i===dimsD-1?0:getVoxel(i+1,j,k,d))slice.set(j,k,0);else{var t=getTextureId(b,flip?td0:td1);slice.set(j,k,t),s1++}}else slice.set(j,k,0)}s0++}var result=[];if(mesher(slice,result),0!==result.length)for(var l=0;l<result.length;l++){var f=result[l],lo=f[0],hi=f[1],sizeu=hi[0]-lo[0],sizev=hi[1]-lo[1],fuvs=[[0,0],[sizeu,0],[sizeu,sizev],[0,sizev]],c=slice.get(lo[0],lo[1]),v0=[],v1=[],v2=[],v3=[];v0[d]=dv,v0[u]=lo[0],v0[v]=lo[1],v1[d]=dv,v1[u]=hi[0],v1[v]=lo[1],v2[d]=dv,v2[u]=hi[0],v2[v]=hi[1],v3[d]=dv,v3[u]=lo[0],v3[v]=hi[1];var vindex=vertices.length;vertices.push(v0,v1,v2,v3),surfaces.push(flip?{face:[vindex+3,vindex+2,vindex+1,vindex,c],uv:[fuvs[3],fuvs[2],fuvs[1],fuvs[0]]}:{face:[vindex,vindex+1,vindex+2,vindex+3,c],uv:[fuvs[0],fuvs[1],fuvs[2],fuvs[3]]})}}function getVoxel(i,j,k,d){return 0===d?data(i,j,k):1===d?data(k,i,j):2===d?data(j,k,i):void 0}function getTextureId(b,side){if(!b)return 0;var map=voxelSideTextureIds[b];return null==map?b:(console.log(side),map[side]||b)}voxelSideTextureIds=voxelSideTextureIds||{};for(var u,v,dimsD,dimsU,dimsV,td0,td1,dv,flip,vertices=[],surfaces=[],d=0;3>d;d++){u=(d+1)%3,v=(d+2)%3,dimsD=dim[d],dimsU=dim[u],dimsV=dim[v],td0=2*d,td1=2*d+1,flip=!1;for(var i=0;dimsD>i;i++)processSlice(i);flip=!0;for(var i=dimsD-1;i>=0;i--)processSlice(i)}return{vertices:vertices,surfaces:surfaces}}},{"greedy-mesher":6,ndarray:14}],63:[function(require,module){(function(global){var THREE="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,gravityUtils=require("./gravityutils");module.exports=function(){"use strict";function onAttach(object,component){"rigidBody"===component.type&&(map[component._id]=component)}function onDettach(object,component){"rigidBody"===component.type&&delete map[component._id]}function tick(){var bodies=[],fixtures=[];for(var id in map){var body=map[id];body.isFixture?fixtures.push(body):bodies.push(body)}for(var i=0;i<bodies.length;i++){var rigidBody=bodies[i],gravity=gravityUtils.getGravity(rigidBody.object.position);if(rigidBody.gravity=gravity,rigidBody.grounded){var gravityForce=gravity.dir.clone().setLength(gravityAmount);rigidBody.applyForce(gravityForce)}else{var gravityForce=gravity.forceDir.clone().setLength(gravityAmount);rigidBody.applyForce(gravityForce)}rigidBody.velocity.add(rigidBody.acceleration),rigidBody.velocity.multiplyScalar(rigidBody.friction),rigidBody.grounded=!1;for(var j=0;j<fixtures.length;j++){var fixture=fixtures[j],velocities={x:new THREE.Vector3(rigidBody.velocity.x,0,0),y:new THREE.Vector3(0,rigidBody.velocity.y,0),z:new THREE.Vector3(0,0,rigidBody.velocity.z)},position=rigidBody.object.position.clone();for(var axis in velocities){var v=velocities[axis],raycaster=new THREE.Raycaster(position,v.clone().normalize(),0,v.length()+.5),intersects=raycaster.intersectObject(fixture.object,!0);if(intersects.length>0){var intersect=intersects[0],mag=intersect.distance-.5;rigidBody.velocity[axis]=rigidBody.velocity[axis]>0?mag:-mag,axis===gravity.axis&&(rigidBody.grounded=!0)}position.add(v)}}rigidBody.object.position.add(rigidBody.velocity),rigidBody.acceleration.set(0,0,0)}}var map={},gravityAmount=(new THREE.Vector3,.05),physics={onAttach:onAttach,onDettach:onDettach,tick:tick,app:null};return physics}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./gravityutils":61}]},{},[53]);