var THREE = require('three');

module.exports = function(object) {
  "use strict";

  var geometry = new THREE.BoxGeometry(1, 1, 1);
  var material = new THREE.MeshBasicMaterial({
    color: 0xff0000
  });
  var moveSpeed = 0.5;
  var jumpSpeed = 0.8;

  var mesh = new THREE.Mesh(geometry, material);
  object.add(mesh);
  var jumping = false;

  function tick() {
    character.gravity = this.rigidBody.gravity;
    if (jumping && this.rigidBody.grounded) {
      jumping = false;
    }
  };

  function move(forward, amount) {
    var gravity = this.rigidBody.gravity;
    if(gravity == null) {
      return;
    }
    if (this.rigidBody.grounded || jumping) {
      var verticalSpeed = this.rigidBody.velocity.clone().projectOnVector(gravity.dir);
      var forwardSpeed = forward.clone().setLength(amount * moveSpeed);
      this.rigidBody.velocity.copy(verticalSpeed.add(forwardSpeed));
    }
  };

  function jump(amount) {
    var gravity = this.rigidBody.gravity;
    if(gravity == null) {
      return;
    }
    if (this.rigidBody.grounded) {
      jumping = true;
      this.rigidBody.velocity.copy(gravity.dir.clone().multiplyScalar(-jumpSpeed));
    }
  };

  var character = {
    tick: tick,
    move: move,
    jump: jump,
    rigidBody: null
  };

  return character;
};